



<!doctype html>
<html lang="zh" class="no-js">
  <head>

      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">

        <meta name="description" content="CTF Wiki">


        <link rel="canonical" href="https://ctf-wiki.github.io/ctf-wiki/crypto/blockcipher/mode/padding-oracle-attack/">


        <meta name="author" content="CTF Wiki Team">


        <meta name="lang:clipboard.copy" content="复制">

        <meta name="lang:clipboard.copied" content="已复制">

        <meta name="lang:search.language" content="jp">

        <meta name="lang:search.pipeline.stopwords" content="True">

        <meta name="lang:search.pipeline.trimmer" content="True">

        <meta name="lang:search.result.none" content="没有找到符合条件的结果">

        <meta name="lang:search.result.one" content="找到 1 个符合条件的结果">

        <meta name="lang:search.result.other" content="# 个符合条件的结果">

        <meta name="lang:search.tokenizer" content="[\uff0c\u3002]+">

      <link rel="shortcut icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.2">



        <title>Padding oracle attack - CTF Wiki</title>



      <link rel="stylesheet" href="../../../../assets/stylesheets/application.adb8469c.css">

        <link rel="stylesheet" href="../../../../assets/stylesheets/application-palette.a8b3c06d.css">




        <meta name="theme-color" content="">



      <script src="../../../../assets/javascripts/modernizr.86422ebf.js"></script>



        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans:300,400,400i,700%7CSource+Code+Pro&display=fallback">
        <style>body,input{font-family:"Noto Sans","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Source Code Pro","Courier New",Courier,monospace}</style>


    <link rel="stylesheet" href="../../../../assets/fonts/material-icons.css">


      <link rel="stylesheet" href="../../../../stylesheets/dark_theme.css">

      <link rel="stylesheet" href="../../../../stylesheets/codehilite.css">

      <link rel="stylesheet" href="../../../../_static/css/extra.css">





<meta name="theme-color" content="#212121">

<link rel='icon' href='/assets/images/favicon.ico'>

<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='mobile-web-app-capable' content='yes'>
<link rel="manifest" href="/manifest.json">

  </head>



    <body dir="ltr" data-md-color-primary="blue" data-md-color-accent="red">

    <svg class="md-svg">
      <defs>


          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>

      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>

      <a href="#padding-oracle-attack" tabindex="0" class="md-skip">
        跳转至
      </a>


      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://ctf-wiki.github.io/ctf-wiki/" title="CTF Wiki" aria-label="CTF Wiki" class="md-header-nav__button md-logo">

            <i class="md-icon">school</i>

        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">

            <span class="md-header-nav__topic">
              CTF Wiki
            </span>
            <span class="md-header-nav__topic">

                Padding oracle attack

            </span>

        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">

          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>

<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            键入以开始搜索
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>

        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">





<a href="https://github.com/ctf-wiki/ctf-wiki/" title="前往 Github 仓库" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>

  <div class="md-source__repository">
    ctf-wiki/ctf-wiki
  </div>
</a>
          </div>
        </div>

    </div>
  </nav>
</header>

    <div class="md-container">






<nav class="md-tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">




    <li class="md-tabs__item">

        <a href="../../../.." class="md-tabs__link">
          Introduction
        </a>

    </li>






    <li class="md-tabs__item">

        <a href="../../../../misc/introduction-zh/" class="md-tabs__link">
          Misc
        </a>

    </li>






    <li class="md-tabs__item">

        <a href="../../../introduction-zh/" class="md-tabs__link">
          Crypto
        </a>

    </li>






    <li class="md-tabs__item">

        <a href="../../../../web/introduction-zh/" class="md-tabs__link">
          Web
        </a>

    </li>






    <li class="md-tabs__item">

        <a href="../../../../assembly/x86-x64/readme-zh/" class="md-tabs__link">
          Assembly
        </a>

    </li>










    <li class="md-tabs__item">

        <a href="../../../../executable/elf/elf-structure-zh/" class="md-tabs__link">
          Executable
        </a>

    </li>












    <li class="md-tabs__item">

        <a href="../../../../reverse/introduction-zh/" class="md-tabs__link">
          Reverse Engineering
        </a>

    </li>












    <li class="md-tabs__item">

        <a href="../../../../pwn/readme-zh/" class="md-tabs__link">
          Pwn
        </a>

    </li>








    <li class="md-tabs__item">

        <a href="../../../../android/basic_develop/basic_develop-zh/" class="md-tabs__link">
          Android
        </a>

    </li>






    <li class="md-tabs__item">

        <a href="../../../../ics/ctfs-zh/" class="md-tabs__link">
          ICS
        </a>

    </li>



    </ul>
  </div>
</nav>

      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">


              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://ctf-wiki.github.io/ctf-wiki/" title="CTF Wiki" class="md-nav__button md-logo">

        <i class="md-icon">school</i>

    </a>
    CTF Wiki
  </label>

    <div class="md-nav__source">





<a href="https://github.com/ctf-wiki/ctf-wiki/" title="前往 Github 仓库" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>

  <div class="md-source__repository">
    ctf-wiki/ctf-wiki
  </div>
</a>
    </div>

  <ul class="md-nav__list" data-md-scrollfix>






  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">

    <label class="md-nav__link" for="nav-1">
      Introduction
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Introduction
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../.." title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../introduction/history-zh/" title="CTF History" class="md-nav__link">
      CTF History
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../introduction/mode-zh/" title="Introduction to CTF Competition Form" class="md-nav__link">
      Introduction to CTF Competition Form
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../introduction/content-zh/" title="CTF Contest Content" class="md-nav__link">
      CTF Contest Content
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../introduction/experience-zh/" title="Offline Attack and Defense Experience Summary" class="md-nav__link">
      Offline Attack and Defense Experience Summary
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../introduction/cgc-zh/" title="CGC Super Challenge" class="md-nav__link">
      CGC Super Challenge
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../introduction/resources-zh/" title="Learning Resources" class="md-nav__link">
      Learning Resources
    </a>
  </li>


      </ul>
    </nav>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">

    <label class="md-nav__link" for="nav-2">
      Misc
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Misc
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../../misc/introduction-zh/" title="Miscellaneous Introduction" class="md-nav__link">
      Miscellaneous Introduction
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../misc/recon-zh/" title="Information Gathering Technology" class="md-nav__link">
      Information Gathering Technology
    </a>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-3" type="checkbox" id="nav-2-3">

    <label class="md-nav__link" for="nav-2-3">
      Code Analysis
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-3">
        Code Analysis
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../../misc/encode/communication-zh/" title="Commonly Used Coding in the Communication Field" class="md-nav__link">
      Commonly Used Coding in the Communication Field
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../misc/encode/computer-zh/" title="Computer Related Coding" class="md-nav__link">
      Computer Related Coding
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../misc/encode/modern-zh/" title="Commonly Used Encodings in the Real World" class="md-nav__link">
      Commonly Used Encodings in the Real World
    </a>
  </li>


      </ul>
    </nav>
  </li>







  <li class="md-nav__item">
    <a href="../../../../misc/prefix-zh/" title="Forensic Steganography" class="md-nav__link">
      Forensic Steganography
    </a>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-5" type="checkbox" id="nav-2-5">

    <label class="md-nav__link" for="nav-2-5">
      Image Analysis
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-5">
        Image Analysis
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../../misc/picture/introduction-zh/" title="Introduction to Image Analysis" class="md-nav__link">
      Introduction to Image Analysis
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../misc/picture/png-zh/" title="PNG" class="md-nav__link">
      PNG
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../misc/picture/jpg-zh/" title="JPG" class="md-nav__link">
      JPG
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../misc/picture/gif-zh/" title="GIF" class="md-nav__link">
      GIF
    </a>
  </li>


      </ul>
    </nav>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-6" type="checkbox" id="nav-2-6">

    <label class="md-nav__link" for="nav-2-6">
      Traffic Packet Analysis
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-6">
        Traffic Packet Analysis
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../../misc/traffic/introduction-zh/" title="Introduction to Traffic Packet Analysis" class="md-nav__link">
      Introduction to Traffic Packet Analysis
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../misc/traffic/fix-zh/" title="PCAP File Repairing" class="md-nav__link">
      PCAP File Repairing
    </a>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-6-3" type="checkbox" id="nav-2-6-3">

    <label class="md-nav__link" for="nav-2-6-3">
      Protocol Analysis
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-2-6-3">
        Protocol Analysis
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../../misc/traffic/protocols/README-zh/" title="Overview of Protocol Analysis" class="md-nav__link">
      Overview of Protocol Analysis
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../misc/traffic/protocols/Wireshark-zh/" title="Wireshark" class="md-nav__link">
      Wireshark
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../misc/traffic/protocols/HTTP-zh/" title="HTTP" class="md-nav__link">
      HTTP
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../misc/traffic/protocols/HTTPS-zh/" title="HTTPS" class="md-nav__link">
      HTTPS
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../misc/traffic/protocols/FTP-zh/" title="FTP" class="md-nav__link">
      FTP
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../misc/traffic/protocols/DNS-zh/" title="DNS" class="md-nav__link">
      DNS
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../misc/traffic/protocols/WIFI-zh/" title="WIFI" class="md-nav__link">
      WIFI
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../misc/traffic/protocols/USB-zh/" title="USB" class="md-nav__link">
      USB
    </a>
  </li>


      </ul>
    </nav>
  </li>







  <li class="md-nav__item">
    <a href="../../../../misc/traffic/data-zh/" title="Data Extraction" class="md-nav__link">
      Data Extraction
    </a>
  </li>


      </ul>
    </nav>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-7" type="checkbox" id="nav-2-7">

    <label class="md-nav__link" for="nav-2-7">
      Compressed Package Analysis
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-7">
        Compressed Package Analysis
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../../misc/archive/zip-zh/" title="ZIP Format" class="md-nav__link">
      ZIP Format
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../misc/archive/rar-zh/" title="RAR Format" class="md-nav__link">
      RAR Format
    </a>
  </li>


      </ul>
    </nav>
  </li>







  <li class="md-nav__item">
    <a href="../../../../misc/audio/introduction-zh/" title="Audio Steganography" class="md-nav__link">
      Audio Steganography
    </a>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-9" type="checkbox" id="nav-2-9">

    <label class="md-nav__link" for="nav-2-9">
      Disk Memory Analysis
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-9">
        Disk Memory Analysis
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../../misc/disk-memory/introduction-zh/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../misc/disk-memory/problem-zh/" title="Title" class="md-nav__link">
      Title
    </a>
  </li>


      </ul>
    </nav>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-10" type="checkbox" id="nav-2-10">

    <label class="md-nav__link" for="nav-2-10">
      Other
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-10">
        Other
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../../misc/other/pyc-zh/" title="pyc File" class="md-nav__link">
      pyc File
    </a>
  </li>


      </ul>
    </nav>
  </li>


      </ul>
    </nav>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">

    <label class="md-nav__link" for="nav-3">
      Crypto
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Crypto
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../introduction-zh/" title="Introduction to Cryptography" class="md-nav__link">
      Introduction to Cryptography
    </a>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-2" type="checkbox" id="nav-3-2">

    <label class="md-nav__link" for="nav-3-2">
      Basic Mathematics
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-2">
        Basic Mathematics
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../basic/introduction-zh/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>


      </ul>
    </nav>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-3" type="checkbox" id="nav-3-3">

    <label class="md-nav__link" for="nav-3-3">
      Classical Cryptography
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-3">
        Classical Cryptography
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../classical/introduction-zh/" title="Introduction to Classical Cryptography" class="md-nav__link">
      Introduction to Classical Cryptography
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../classical/monoalphabetic-zh/" title="Single table Substitution Cipher" class="md-nav__link">
      Single table Substitution Cipher
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../classical/polyalphabetic-zh/" title="Multi-table Substitution Cipher" class="md-nav__link">
      Multi-table Substitution Cipher
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../classical/others-zh/" title="Other Types of Cipher" class="md-nav__link">
      Other Types of Cipher
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../classical/summary-zh/" title="Summary" class="md-nav__link">
      Summary
    </a>
  </li>


      </ul>
    </nav>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-4" type="checkbox" id="nav-3-4">

    <label class="md-nav__link" for="nav-3-4">
      Stream Cipher
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-4">
        Stream Cipher
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../streamcipher/intro-zh/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-4-2" type="checkbox" id="nav-3-4-2">

    <label class="md-nav__link" for="nav-3-4-2">
      Pseudo Random Number Generator
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-4-2">
        Pseudo Random Number Generator
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../streamcipher/prng/intro-zh/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../streamcipher/prng/csprng-zh/" title="Cryptographic Security Pseudo-random Number Generator" class="md-nav__link">
      Cryptographic Security Pseudo-random Number Generator
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../streamcipher/prng/problem-zh/" title="Challenge Examples" class="md-nav__link">
      Challenge Examples
    </a>
  </li>


      </ul>
    </nav>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-4-3" type="checkbox" id="nav-3-4-3">

    <label class="md-nav__link" for="nav-3-4-3">
      Linear Congruence Generator
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-4-3">
        Linear Congruence Generator
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../streamcipher/lcg/intro-zh/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../streamcipher/lcg/challenge-zh/" title="Example" class="md-nav__link">
      Example
    </a>
  </li>


      </ul>
    </nav>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-4-4" type="checkbox" id="nav-3-4-4">

    <label class="md-nav__link" for="nav-3-4-4">
      Feedback Shift Register
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-4-4">
        Feedback Shift Register
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../streamcipher/fsr/intro-zh/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../streamcipher/fsr/lfsr-zh/" title="Linear Feedback Shift Register" class="md-nav__link">
      Linear Feedback Shift Register
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../streamcipher/fsr/nfsr-zh/" title="Nonlinear Feedback Shift Register" class="md-nav__link">
      Nonlinear Feedback Shift Register
    </a>
  </li>


      </ul>
    </nav>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-4-5" type="checkbox" id="nav-3-4-5">

    <label class="md-nav__link" for="nav-3-4-5">
      Special Stream Cipher
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-4-5">
        Special Stream Cipher
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../streamcipher/special/rc4-zh/" title="RC4" class="md-nav__link">
      RC4
    </a>
  </li>


      </ul>
    </nav>
  </li>


      </ul>
    </nav>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-5" type="checkbox" id="nav-3-5">

    <label class="md-nav__link" for="nav-3-5">
      Block Cipher
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-5">
        Block Cipher
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../introduction-zh/" title="Introduction to Block Cipher" class="md-nav__link">
      Introduction to Block Cipher
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../arx-operations-zh/" title="ARX" class="md-nav__link">
      ARX
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../des-zh/" title="DES" class="md-nav__link">
      DES
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../idea-zh/" title="IDEA" class="md-nav__link">
      IDEA
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../aes-zh/" title="AES" class="md-nav__link">
      AES
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../simon-speck-zh/" title="Simon and Speck" class="md-nav__link">
      Simon and Speck
    </a>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-5-7" type="checkbox" id="nav-3-5-7">

    <label class="md-nav__link" for="nav-3-5-7">
      Group Mode
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-5-7">
        Group Mode
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../introduction-zh/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../padding-zh/" title="Padding Methods" class="md-nav__link">
      Padding Methods
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../ecb-zh/" title="ECB" class="md-nav__link">
      ECB
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../cbc-zh/" title="CBC" class="md-nav__link">
      CBC
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../pcbc-zh/" title="PCBC" class="md-nav__link">
      PCBC
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../cfb-zh/" title="CFB" class="md-nav__link">
      CFB
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../ofb-zh/" title="OFB" class="md-nav__link">
      OFB
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../ctr-zh/" title="CTR" class="md-nav__link">
      CTR
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../padding-oracle-attack-zh/" title="Padding Oracle Attack" class="md-nav__link">
      Padding Oracle Attack
    </a>
  </li>


      </ul>
    </nav>
  </li>


      </ul>
    </nav>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-6" type="checkbox" id="nav-3-6">

    <label class="md-nav__link" for="nav-3-6">
      Asymmetric Cryptography
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-6">
        Asymmetric Cryptography
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../asymmetric/introduction-zh/" title="Introduction to Asymmetric Cryptography" class="md-nav__link">
      Introduction to Asymmetric Cryptography
    </a>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-6-2" type="checkbox" id="nav-3-6-2">

    <label class="md-nav__link" for="nav-3-6-2">
      RSA
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-6-2">
        RSA
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../asymmetric/rsa/rsa_theory-zh/" title="RSA Introduction" class="md-nav__link">
      RSA Introduction
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../asymmetric/rsa/rsa_module_attack-zh/" title="Modulo-related Attacks" class="md-nav__link">
      Modulo-related Attacks
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../asymmetric/rsa/rsa_e_attack-zh/" title="Public Key Index Related Attacks" class="md-nav__link">
      Public Key Index Related Attacks
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../asymmetric/rsa/rsa_d_attack-zh/" title="Private Key d Related Attacks" class="md-nav__link">
      Private Key d Related Attacks
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../asymmetric/rsa/rsa_coppersmith_attack-zh/" title="Coppersmith Related Attacks" class="md-nav__link">
      Coppersmith Related Attacks
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../asymmetric/rsa/rsa_chosen_plain_cipher-zh/" title="Chosen Plain Cipher Attack" class="md-nav__link">
      Chosen Plain Cipher Attack
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../asymmetric/rsa/rsa_side_channel-zh/" title="Side Channel Attack" class="md-nav__link">
      Side Channel Attack
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../asymmetric/rsa/rsa_pkcs_attack-zh/" title="Bleichenbacher Attack" class="md-nav__link">
      Bleichenbacher Attack
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../asymmetric/rsa/rsa_complex-zh/" title="Challenge Examples" class="md-nav__link">
      Challenge Examples
    </a>
  </li>


      </ul>
    </nav>
  </li>







  <li class="md-nav__item">
    <a href="../../../asymmetric/knapsack/knapsack-zh/" title="Knapsack Cipher" class="md-nav__link">
      Knapsack Cipher
    </a>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-6-4" type="checkbox" id="nav-3-6-4">

    <label class="md-nav__link" for="nav-3-6-4">
      Discrete Log Correlation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-6-4">
        Discrete Log Correlation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../asymmetric/discrete-log/discrete-log-zh/" title="Discrete Logarithm" class="md-nav__link">
      Discrete Logarithm
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../asymmetric/discrete-log/elgamal-zh/" title="Elgamal" class="md-nav__link">
      Elgamal
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../asymmetric/discrete-log/ecc-zh/" title="ECC" class="md-nav__link">
      ECC
    </a>
  </li>


      </ul>
    </nav>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-6-5" type="checkbox" id="nav-3-6-5">

    <label class="md-nav__link" for="nav-3-6-5">
      Lattice-based Cryptography
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-6-5">
        Lattice-based Cryptography
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../asymmetric/lattice/overview-zh/" title="Lattice Overview" class="md-nav__link">
      Lattice Overview
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../asymmetric/lattice/introduction-zh/" title="Introduction to Lattices" class="md-nav__link">
      Introduction to Lattices
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../asymmetric/lattice/lattice-reduction-zh/" title="Lattice-based Algorithm" class="md-nav__link">
      Lattice-based Algorithm
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../asymmetric/lattice/cvp-zh/" title="CVP" class="md-nav__link">
      CVP
    </a>
  </li>


      </ul>
    </nav>
  </li>


      </ul>
    </nav>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-7" type="checkbox" id="nav-3-7">

    <label class="md-nav__link" for="nav-3-7">
      Hash Function
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-7">
        Hash Function
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../hash/introduction-zh/" title="Introduction to the Hash Function" class="md-nav__link">
      Introduction to the Hash Function
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../hash/md5-zh/" title="MD5" class="md-nav__link">
      MD5
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../hash/sha1-zh/" title="SHA1" class="md-nav__link">
      SHA1
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../hash/fnv-zh/" title="FNV" class="md-nav__link">
      FNV
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../hash/attack-zh/" title="Hash Attack" class="md-nav__link">
      Hash Attack
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../hash/complex-zh/" title="Challenge Examples" class="md-nav__link">
      Challenge Examples
    </a>
  </li>


      </ul>
    </nav>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-8" type="checkbox" id="nav-3-8">

    <label class="md-nav__link" for="nav-3-8">
      Digital Signature
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-8">
        Digital Signature
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../signature/introduction-zh/" title="Introduction to Digital Signatures" class="md-nav__link">
      Introduction to Digital Signatures
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../signature/rsa-zh/" title="RSA Digital Signature" class="md-nav__link">
      RSA Digital Signature
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../signature/elgamal-zh/" title="ElGamal Digital Signature" class="md-nav__link">
      ElGamal Digital Signature
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../signature/dsa-zh/" title="DSA Digital Signature" class="md-nav__link">
      DSA Digital Signature
    </a>
  </li>


      </ul>
    </nav>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-9" type="checkbox" id="nav-3-9">

    <label class="md-nav__link" for="nav-3-9">
      Summary of Attack Techniques
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-9">
        Summary of Attack Techniques
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../attack-summary/attack-mode-zh/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../attack-summary/meet-in-the-middle-zh/" title="Intermediate Encounter Attack" class="md-nav__link">
      Intermediate Encounter Attack
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../attack-summary/bit-attack-zh/" title="Bit attack" class="md-nav__link">
      Bit attack
    </a>
  </li>


      </ul>
    </nav>
  </li>







  <li class="md-nav__item">
    <a href="../../../certificate/introduction-zh/" title="Certificate Format" class="md-nav__link">
      Certificate Format
    </a>
  </li>


      </ul>
    </nav>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">

    <label class="md-nav__link" for="nav-4">
      Web
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Web
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../../web/introduction-zh/" title="Introduction to Web Applications" class="md-nav__link">
      Introduction to Web Applications
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../web/sqli-zh/" title="SQL Injection" class="md-nav__link">
      SQL Injection
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../web/xss-zh/" title="XSS Cross-site Scripting Attack" class="md-nav__link">
      XSS Cross-site Scripting Attack
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../web/csrf-zh/" title="CSRF Cross-site Request Forgery" class="md-nav__link">
      CSRF Cross-site Request Forgery
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../web/ssrf-zh/" title="SSRF Server Request Forgery" class="md-nav__link">
      SSRF Server Request Forgery
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../web/php/php-zh/" title="PHP Code Auditing" class="md-nav__link">
      PHP Code Auditing
    </a>
  </li>


      </ul>
    </nav>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">

    <label class="md-nav__link" for="nav-5">
      Assembly
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Assembly
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../../assembly/x86-x64/readme-zh/" title="x86_x64" class="md-nav__link">
      x86_x64
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../assembly/mips/readme-zh/" title="mips" class="md-nav__link">
      mips
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../assembly/arm/readme-zh/" title="arm" class="md-nav__link">
      arm
    </a>
  </li>


      </ul>
    </nav>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">

    <label class="md-nav__link" for="nav-6">
      Executable
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Executable
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-1" type="checkbox" id="nav-6-1">

    <label class="md-nav__link" for="nav-6-1">
      ELF file
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-1">
        ELF file
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../../executable/elf/elf-structure-zh/" title="ELF File Basic Structure" class="md-nav__link">
      ELF File Basic Structure
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../executable/elf/program-loading-zh/" title="Program Loading" class="md-nav__link">
      Program Loading
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../executable/elf/program-linking-zh/" title="Program Link" class="md-nav__link">
      Program Link
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../executable/elf/running-overview-zh/" title="Program Execution Flow" class="md-nav__link">
      Program Execution Flow
    </a>
  </li>


      </ul>
    </nav>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-2" type="checkbox" id="nav-6-2">

    <label class="md-nav__link" for="nav-6-2">
      PE file
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-2">
        PE file
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../../executable/pe/pe-excutable-zh/" title="PE File Basic Structure" class="md-nav__link">
      PE File Basic Structure
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../executable/pe/pe-import-table-zh/" title="PE Import Table" class="md-nav__link">
      PE Import Table
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../executable/pe/pe-export-table-zh/" title="PE Export Table" class="md-nav__link">
      PE Export Table
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../executable/pe/pe-relocation-table-zh/" title="PE Relocation Table" class="md-nav__link">
      PE Relocation Table
    </a>
  </li>


      </ul>
    </nav>
  </li>


      </ul>
    </nav>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">

    <label class="md-nav__link" for="nav-7">
      Reverse Engineering
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Reverse Engineering
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-1" type="checkbox" id="nav-7-1">

    <label class="md-nav__link" for="nav-7-1">
      Reverse Overview
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-1">
        Reverse Overview
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../../reverse/introduction-zh/" title="Software Reverse Engineering Introduction" class="md-nav__link">
      Software Reverse Engineering Introduction
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../reverse/Identify-Encode-Encryption/introduction-zh/" title="Common Encryption Algorithms and Code Recognition" class="md-nav__link">
      Common Encryption Algorithms and Code Recognition
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../reverse/maze/maze-zh/" title="Labyrinth Problem" class="md-nav__link">
      Labyrinth Problem
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../reverse/vm/vm-zh/" title="Virtual Machine Command Analysis" class="md-nav__link">
      Virtual Machine Command Analysis
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../reverse/unicorn/introduction-zh/" title="Unicorn Engine Introduction" class="md-nav__link">
      Unicorn Engine Introduction
    </a>
  </li>


      </ul>
    </nav>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-2" type="checkbox" id="nav-7-2">

    <label class="md-nav__link" for="nav-7-2">
      Linux Reverse
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-2">
        Linux Reverse
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-2-1" type="checkbox" id="nav-7-2-1">

    <label class="md-nav__link" for="nav-7-2-1">
      Linux Reverse Technology
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-7-2-1">
        Linux Reverse Technology
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../../reverse/linux/ld_preload-zh/" title="LD_PRELOAD" class="md-nav__link">
      LD_PRELOAD
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../reverse/linux/false-disasm-zh/" title="Incorrect Disassembly Fix" class="md-nav__link">
      Incorrect Disassembly Fix
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../reverse/linux/detect-bp-zh/" title="Detecting Breakpoints Bypassing" class="md-nav__link">
      Detecting Breakpoints Bypassing
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../reverse/linux/detect-dbg-zh/" title="Detecting Debugging Bypassing" class="md-nav__link">
      Detecting Debugging Bypassing
    </a>
  </li>


      </ul>
    </nav>
  </li>


      </ul>
    </nav>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-3" type="checkbox" id="nav-7-3">

    <label class="md-nav__link" for="nav-7-3">
      Windows Reverse
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-3">
        Windows Reverse
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-3-1" type="checkbox" id="nav-7-3-1">

    <label class="md-nav__link" for="nav-7-3-1">
      Shelling Technology
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-7-3-1">
        Shelling Technology
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../../reverse/windows/unpack/packer-introduction-zh/" title="Introduction to the Protective case" class="md-nav__link">
      Introduction to the Protective case
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../reverse/windows/unpack/trace-zh/" title="Single Step Tracking Method" class="md-nav__link">
      Single Step Tracking Method
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../reverse/windows/unpack/esp-zh/" title="ESP Law" class="md-nav__link">
      ESP Law
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../reverse/windows/unpack/direct-oep-zh/" title="One Step to the OEP Method" class="md-nav__link">
      One Step to the OEP Method
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../reverse/windows/unpack/memory-zh/" title="Memory Mirroring Method" class="md-nav__link">
      Memory Mirroring Method
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../reverse/windows/unpack/last-exception-zh/" title="Last Exception Method" class="md-nav__link">
      Last Exception Method
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../reverse/windows/unpack/sfx-zh/" title="SFX Method" class="md-nav__link">
      SFX Method
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../reverse/windows/unpack/fix-iat-zh/" title="DUMP and IAT Reconstruction" class="md-nav__link">
      DUMP and IAT Reconstruction
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../reverse/windows/unpack/manually-fix-iat-zh/" title="Manually Find the IAT and Rebuild It Using ImportREC" class="md-nav__link">
      Manually Find the IAT and Rebuild It Using ImportREC
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../reverse/windows/unpack/unpack-dll-zh/" title="DLL File Unpacking" class="md-nav__link">
      DLL File Unpacking
    </a>
  </li>


      </ul>
    </nav>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-3-2" type="checkbox" id="nav-7-3-2">

    <label class="md-nav__link" for="nav-7-3-2">
      Anti-debugging Technology
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-7-3-2">
        Anti-debugging Technology
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../../reverse/windows/anti-debug/ntglobalflag-zh/" title="NtGlobalFlag" class="md-nav__link">
      NtGlobalFlag
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../reverse/windows/anti-debug/heap-flags-zh/" title="Heap Flags" class="md-nav__link">
      Heap Flags
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../reverse/windows/anti-debug/the-heap-zh/" title="The Heap" class="md-nav__link">
      The Heap
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../reverse/windows/anti-debug/int-3-zh/" title="Interrupt 3" class="md-nav__link">
      Interrupt 3
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../reverse/windows/anti-debug/isdebuggerpresent-zh/" title="IsDebuggerPresent" class="md-nav__link">
      IsDebuggerPresent
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../reverse/windows/anti-debug/checkremotedebuggerpresent-zh/" title="CheckRemoteDebuggerPresent" class="md-nav__link">
      CheckRemoteDebuggerPresent
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../reverse/windows/anti-debug/ntqueryinformationprocess-zh/" title="NtQueryInformationProcess" class="md-nav__link">
      NtQueryInformationProcess
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../reverse/windows/anti-debug/junk-code-zh/" title="Flower command" class="md-nav__link">
      Flower command
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../reverse/windows/anti-debug/example-zh/" title="Anti-debug technical example" class="md-nav__link">
      Anti-debug technical example
    </a>
  </li>


      </ul>
    </nav>
  </li>


      </ul>
    </nav>
  </li>


      </ul>
    </nav>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">

    <label class="md-nav__link" for="nav-8">
      Pwn
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Pwn
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-1" type="checkbox" id="nav-8-1">

    <label class="md-nav__link" for="nav-8-1">
      Pwn Overview
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-8-1">
        Pwn Overview
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../../pwn/readme-zh/" title="Readme zh" class="md-nav__link">
      Readme zh
    </a>
  </li>


      </ul>
    </nav>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-2" type="checkbox" id="nav-8-2">

    <label class="md-nav__link" for="nav-8-2">
      Linux Pwn
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-8-2">
        Linux Pwn
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-2-1" type="checkbox" id="nav-8-2-1">

    <label class="md-nav__link" for="nav-8-2-1">
      Security Protection Mechanism
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-8-2-1">
        Security Protection Mechanism
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/mitigation/canary-zh/" title="Canary" class="md-nav__link">
      Canary
    </a>
  </li>


      </ul>
    </nav>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-2-2" type="checkbox" id="nav-8-2-2">

    <label class="md-nav__link" for="nav-8-2-2">
      Stack Overflow
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-8-2-2">
        Stack Overflow
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/stackoverflow/stack-intro-zh/" title="Stack Introduction" class="md-nav__link">
      Stack Introduction
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/stackoverflow/stackoverflow-basic-zh/" title="Stack Overflow Principle" class="md-nav__link">
      Stack Overflow Principle
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/stackoverflow/basic-rop-zh/" title="Basic ROP" class="md-nav__link">
      Basic ROP
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/stackoverflow/medium-rop-zh/" title="Intermediate ROP" class="md-nav__link">
      Intermediate ROP
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/stackoverflow/advanced-rop-zh/" title="Advanced ROP" class="md-nav__link">
      Advanced ROP
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/stackoverflow/fancy-rop-zh/" title="ROP Tricks" class="md-nav__link">
      ROP Tricks
    </a>
  </li>


      </ul>
    </nav>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-2-3" type="checkbox" id="nav-8-2-3">

    <label class="md-nav__link" for="nav-8-2-3">
      Format String Vulnerability
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-8-2-3">
        Format String Vulnerability
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/fmtstr/fmtstr_intro-zh/" title="Format String Vulnerability Principle" class="md-nav__link">
      Format String Vulnerability Principle
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/fmtstr/fmtstr_exploit-zh/" title="Format String Exploit" class="md-nav__link">
      Format String Exploit
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/fmtstr/fmtstr_example-zh/" title="Format String Vulnerability Example" class="md-nav__link">
      Format String Vulnerability Example
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/fmtstr/fmtstr_detect-zh/" title="Format String Vulnerability Detection" class="md-nav__link">
      Format String Vulnerability Detection
    </a>
  </li>


      </ul>
    </nav>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-2-4" type="checkbox" id="nav-8-2-4">

    <label class="md-nav__link" for="nav-8-2-4">
      Glibc Heap Related
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-8-2-4">
        Glibc Heap Related
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/glibc-heap/introduction-zh/" title="Introduction to Heap" class="md-nav__link">
      Introduction to Heap
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/glibc-heap/heap_overview-zh/" title="Heap Overview" class="md-nav__link">
      Heap Overview
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/glibc-heap/heap_structure-zh/" title="Heap Related Data Structure" class="md-nav__link">
      Heap Related Data Structure
    </a>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-2-4-4" type="checkbox" id="nav-8-2-4-4">

    <label class="md-nav__link" for="nav-8-2-4-4">
      In-depth Understanding of Ptmalloc2
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-8-2-4-4">
        In-depth Understanding of Ptmalloc2
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/glibc-heap/implementation/overview-zh/" title="Implementation" class="md-nav__link">
      Implementation
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/glibc-heap/implementation/basic-zh/" title="Basic Functions in the heap implementation" class="md-nav__link">
      Basic Functions in the heap implementation
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/glibc-heap/implementation/heap-init-zh/" title="Heap Initialization" class="md-nav__link">
      Heap Initialization
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/glibc-heap/implementation/malloc-zh/" title="Allocate Heap Memory" class="md-nav__link">
      Allocate Heap Memory
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/glibc-heap/implementation/free-zh/" title="Free Heap Memory" class="md-nav__link">
      Free Heap Memory
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/glibc-heap/implementation/tcache-zh/" title="Tcache" class="md-nav__link">
      Tcache
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/glibc-heap/implementation/malloc_state-zh/" title="malloc_state" class="md-nav__link">
      malloc_state
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/glibc-heap/implementation/misc-zh/" title="Other" class="md-nav__link">
      Other
    </a>
  </li>


      </ul>
    </nav>
  </li>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/glibc-heap/heapoverflow_basic-zh/" title="Heap Overflow" class="md-nav__link">
      Heap Overflow
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/glibc-heap/off_by_one-zh/" title="Heap-based Off-By-One" class="md-nav__link">
      Heap-based Off-By-One
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/glibc-heap/chunk_extend_overlapping-zh/" title="Chunk Extend/Overlapping" class="md-nav__link">
      Chunk Extend/Overlapping
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/glibc-heap/unlink-zh/" title="Unlink" class="md-nav__link">
      Unlink
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/glibc-heap/use_after_free-zh/" title="Use After Free" class="md-nav__link">
      Use After Free
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/glibc-heap/fastbin_attack-zh/" title="Fastbin Attack" class="md-nav__link">
      Fastbin Attack
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/glibc-heap/unsorted_bin_attack-zh/" title="Unsorted Bin Attack" class="md-nav__link">
      Unsorted Bin Attack
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/glibc-heap/large_bin_attack-zh/" title="Large Bin Attack" class="md-nav__link">
      Large Bin Attack
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/glibc-heap/tcache_attack-zh/" title="Tcache Attack" class="md-nav__link">
      Tcache Attack
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/glibc-heap/house_of_einherjar-zh/" title="House of Einherjar" class="md-nav__link">
      House of Einherjar
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/glibc-heap/house_of_force-zh/" title="House of Force" class="md-nav__link">
      House of Force
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/glibc-heap/house_of_lore-zh/" title="House of Lore" class="md-nav__link">
      House of Lore
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/glibc-heap/house_of_orange-zh/" title="House of Orange" class="md-nav__link">
      House of Orange
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/glibc-heap/house_of_rabbit-zh/" title="House of Rabbit" class="md-nav__link">
      House of Rabbit
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/glibc-heap/house_of_roman-zh/" title="House of Roman" class="md-nav__link">
      House of Roman
    </a>
  </li>


      </ul>
    </nav>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-2-5" type="checkbox" id="nav-8-2-5">

    <label class="md-nav__link" for="nav-8-2-5">
      IO_FILE Related
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-8-2-5">
        IO_FILE Related
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/io_file/introduction-zh/" title="FILE Structure Description" class="md-nav__link">
      FILE Structure Description
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/io_file/fake-vtable-exploit-zh/" title="Forged Vtable to Hijack Control Flow" class="md-nav__link">
      Forged Vtable to Hijack Control Flow
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/io_file/fsop-zh/" title="FSOP" class="md-nav__link">
      FSOP
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/io_file/exploit-in-libc2.24-zh/" title="Use of IO_FILE Under Glibc 2.24" class="md-nav__link">
      Use of IO_FILE Under Glibc 2.24
    </a>
  </li>


      </ul>
    </nav>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-2-6" type="checkbox" id="nav-8-2-6">

    <label class="md-nav__link" for="nav-8-2-6">
      Race Condition
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-8-2-6">
        Race Condition
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/race-condition/introduction-zh/" title="Race Condition Introduction" class="md-nav__link">
      Race Condition Introduction
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/race-condition/problem-zh/" title="Example" class="md-nav__link">
      Example
    </a>
  </li>


      </ul>
    </nav>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-2-7" type="checkbox" id="nav-8-2-7">

    <label class="md-nav__link" for="nav-8-2-7">
      Integer Overflow
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-8-2-7">
        Integer Overflow
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/integeroverflow/intof-zh/" title="Introduction to The Principle of Integer Overflow" class="md-nav__link">
      Introduction to The Principle of Integer Overflow
    </a>
  </li>


      </ul>
    </nav>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-2-8" type="checkbox" id="nav-8-2-8">

    <label class="md-nav__link" for="nav-8-2-8">
      Sandbox Escape
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-8-2-8">
        Sandbox Escape
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/sandbox/python-sandbox-escape-zh/" title="Python Sandbox Escape" class="md-nav__link">
      Python Sandbox Escape
    </a>
  </li>


      </ul>
    </nav>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-2-9" type="checkbox" id="nav-8-2-9">

    <label class="md-nav__link" for="nav-8-2-9">
      Linux Kernel
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-8-2-9">
        Linux Kernel
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/kernel/environment-zh/" title="Environment Setup" class="md-nav__link">
      Environment Setup
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/kernel/basic_knowledge-zh/" title="Basics" class="md-nav__link">
      Basics
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/kernel/kernel_uaf-zh/" title="Kernel-UAF" class="md-nav__link">
      Kernel-UAF
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/kernel/kernel_rop-zh/" title="Kernel-ROP" class="md-nav__link">
      Kernel-ROP
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/kernel/ret2usr-zh/" title="ret2usr" class="md-nav__link">
      ret2usr
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/kernel/bypass_smep-zh/" title="bypass-smep" class="md-nav__link">
      bypass-smep
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/kernel/double-fetch-zh/" title="Double Fetch" class="md-nav__link">
      Double Fetch
    </a>
  </li>


      </ul>
    </nav>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-2-10" type="checkbox" id="nav-8-2-10">

    <label class="md-nav__link" for="nav-8-2-10">
      arm-pwn
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-8-2-10">
        arm-pwn
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/arm/environment-zh/" title="Environment Setup" class="md-nav__link">
      Environment Setup
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/arm/arm_rop-zh/" title="arm-rop" class="md-nav__link">
      arm-rop
    </a>
  </li>


      </ul>
    </nav>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-2-11" type="checkbox" id="nav-8-2-11">

    <label class="md-nav__link" for="nav-8-2-11">
      Summary
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-8-2-11">
        Summary
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/summary/get-address-zh/" title="Address Leaking" class="md-nav__link">
      Address Leaking
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/summary/hijack-control-flow-zh/" title="Hijack Control Flow" class="md-nav__link">
      Hijack Control Flow
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../pwn/linux/summary/get-shell-zh/" title="Get Shell" class="md-nav__link">
      Get Shell
    </a>
  </li>


      </ul>
    </nav>
  </li>


      </ul>
    </nav>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-3" type="checkbox" id="nav-8-3">

    <label class="md-nav__link" for="nav-8-3">
      Windows Pwn
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-8-3">
        Windows Pwn
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../../pwn/windows/readme-zh/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-3-2" type="checkbox" id="nav-8-3-2">

    <label class="md-nav__link" for="nav-8-3-2">
      Stack Overflow
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-8-3-2">
        Stack Overflow
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../../pwn/windows/stackoverflow/stack-introduce-zh/" title="Stack Introduction" class="md-nav__link">
      Stack Introduction
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../pwn/windows/stackoverflow/stackoverflow-basic-zh/" title="Stack Overflow Principle" class="md-nav__link">
      Stack Overflow Principle
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../pwn/windows/stackoverflow/shellcode-in-stack-zh/" title="shellcode-in-stack" class="md-nav__link">
      shellcode-in-stack
    </a>
  </li>


      </ul>
    </nav>
  </li>


      </ul>
    </nav>
  </li>


      </ul>
    </nav>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">

    <label class="md-nav__link" for="nav-9">
      Android
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Android
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../../android/basic_develop/basic_develop-zh/" title="Android Development Basics" class="md-nav__link">
      Android Development Basics
    </a>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9-2" type="checkbox" id="nav-9-2">

    <label class="md-nav__link" for="nav-9-2">
      Android Application Operating Mechanism Brief
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-9-2">
        Android Application Operating Mechanism Brief
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../../android/basic_operating_mechanism/readme-zh/" title="Basics" class="md-nav__link">
      Basics
    </a>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9-2-2" type="checkbox" id="nav-9-2-2">

    <label class="md-nav__link" for="nav-9-2-2">
      The Operating Mechanism of the Java Layer in Android
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-9-2-2">
        The Operating Mechanism of the Java Layer in Android
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../../android/basic_operating_mechanism/java_layer/readme-zh/" title="Andriod Native" class="md-nav__link">
      Andriod Native
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../android/basic_operating_mechanism/java_layer/smali/smali-zh/" title="Smali Introduction" class="md-nav__link">
      Smali Introduction
    </a>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9-2-2-3" type="checkbox" id="nav-9-2-2-3">

    <label class="md-nav__link" for="nav-9-2-2-3">
      Dex and ODEX
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-9-2-2-3">
        Dex and ODEX
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../../android/basic_operating_mechanism/java_layer/dex/dex-zh/" title="DEX" class="md-nav__link">
      DEX
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../android/basic_operating_mechanism/java_layer/dex/odex-zh/" title="ODEX" class="md-nav__link">
      ODEX
    </a>
  </li>


      </ul>
    </nav>
  </li>


      </ul>
    </nav>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9-2-3" type="checkbox" id="nav-9-2-3">

    <label class="md-nav__link" for="nav-9-2-3">
      Android Native Layer Introduction
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-9-2-3">
        Android Native Layer Introduction
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../../android/basic_operating_mechanism/native_layer/so-zh/" title="Android SO" class="md-nav__link">
      Android SO
    </a>
  </li>


      </ul>
    </nav>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9-2-4" type="checkbox" id="nav-9-2-4">

    <label class="md-nav__link" for="nav-9-2-4">
      Android Reverse Basic Introduction
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-9-2-4">
        Android Reverse Basic Introduction
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../../android/basic_reverse/overview-zh/" title="Brief Description" class="md-nav__link">
      Brief Description
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../android/basic_reverse/android_code_location-zh/" title="Android Key Part Location" class="md-nav__link">
      Android Key Part Location
    </a>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9-2-4-3" type="checkbox" id="nav-9-2-4-3">

    <label class="md-nav__link" for="nav-9-2-4-3">
      Android Simple Static Analysis
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-9-2-4-3">
        Android Simple Static Analysis
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../../android/basic_reverse/static/java-example-zh/" title="Android Java Layer Static Analysis" class="md-nav__link">
      Android Java Layer Static Analysis
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../android/basic_reverse/static/so-example-zh/" title="Android Native Layer Static Analysis" class="md-nav__link">
      Android Native Layer Static Analysis
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../android/basic_reverse/static/complex-example-zh/" title="Android Static Analysis Hybrid Example" class="md-nav__link">
      Android Static Analysis Hybrid Example
    </a>
  </li>


      </ul>
    </nav>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9-2-4-4" type="checkbox" id="nav-9-2-4-4">

    <label class="md-nav__link" for="nav-9-2-4-4">
      Android Simple Dynamic Analysis
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-9-2-4-4">
        Android Simple Dynamic Analysis
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../../android/basic_reverse/dynamic/dynamic_debug-zh/" title="Dynamic Debugging" class="md-nav__link">
      Dynamic Debugging
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../android/basic_reverse/dynamic/ida_native_debug-zh/" title="Android Dynamic Debugging SO" class="md-nav__link">
      Android Dynamic Debugging SO
    </a>
  </li>


      </ul>
    </nav>
  </li>


      </ul>
    </nav>
  </li>


      </ul>
    </nav>
  </li>


      </ul>
    </nav>
  </li>







  <li class="md-nav__item md-nav__item--nested">

      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">

    <label class="md-nav__link" for="nav-10">
      ICS
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        ICS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>







  <li class="md-nav__item">
    <a href="../../../../ics/ctfs-zh/" title="ICS_CTF Contest" class="md-nav__link">
      ICS_CTF Contest
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../ics/discover-zh/" title="ICS_CTF found" class="md-nav__link">
      ICS_CTF found
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../ics/exploit-zh/" title="ICS_CTF uses" class="md-nav__link">
      ICS_CTF uses
    </a>
  </li>







  <li class="md-nav__item">
    <a href="../../../../ics/learn-zh/" title="ICS_CTF Learning Resources" class="md-nav__link">
      ICS_CTF Learning Resources
    </a>
  </li>


      </ul>
    </nav>
  </li>


  </ul>
</nav>
                  </div>
                </div>
              </div>


              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">

<nav class="md-nav md-nav--secondary">





    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>

        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>

</li>

        <li class="md-nav__item">
  <a href="#principle" class="md-nav__link">
    Principle
  </a>

</li>

        <li class="md-nav__item">
  <a href="#2017-hitcon-secret-server" class="md-nav__link">
    2017 HITCON Secret Server
  </a>

    <nav class="md-nav">
      <ul class="md-nav__list">

          <li class="md-nav__item">
  <a href="#analysis" class="md-nav__link">
    Analysis
  </a>

</li>

          <li class="md-nav__item">
  <a href="#main-vulnerabilities" class="md-nav__link">
    Main Vulnerabilities
  </a>

</li>

          <li class="md-nav__item">
  <a href="#using-ideas" class="md-nav__link">
    Using ideas
  </a>

</li>

      </ul>
    </nav>

</li>

        <li class="md-nav__item">
  <a href="#2017-hitcon-secret-server-revenge" class="md-nav__link">
    2017 HITCON Secret Server Revenge
  </a>

    <nav class="md-nav">
      <ul class="md-nav__list">

          <li class="md-nav__item">
  <a href="#description" class="md-nav__link">
    Description
  </a>

</li>

          <li class="md-nav__item">
  <a href="#analysis_1" class="md-nav__link">
    Analysis
  </a>

</li>

          <li class="md-nav__item">
  <a href="#vulnerability" class="md-nav__link">
    Vulnerability
  </a>

</li>

          <li class="md-nav__item">
  <a href="#using-ideas_1" class="md-nav__link">
    Using ideas
  </a>

</li>

      </ul>
    </nav>

</li>

        <li class="md-nav__item">
  <a href="#teaser-dragon-ctf-2018-aes-128-tsb" class="md-nav__link">
    Teaser Dragon CTF 2018 AES-128-TSB
  </a>

    <nav class="md-nav">
      <ul class="md-nav__list">

          <li class="md-nav__item">
  <a href="#get-the-last-byte-of-the-plaintext" class="md-nav__link">
    Get the last byte of the plaintext
  </a>

</li>

          <li class="md-nav__item">
  <a href="#decrypt-any-encrypted-block" class="md-nav__link">
    Decrypt any encrypted block
  </a>

</li>

          <li class="md-nav__item">
  <a href="#decrypt-the-specified-plaintext" class="md-nav__link">
    Decrypt the specified plaintext
  </a>

</li>

          <li class="md-nav__item">
  <a href="#decrypt-flag" class="md-nav__link">
    Decrypt flag
  </a>

</li>

      </ul>
    </nav>

</li>

        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    References
  </a>

</li>





        <li class="md-nav__item">
          <a href="#__comments" class="md-nav__link md-nav__link--active">
            评论
          </a>
        </li>

    </ul>

</nav>
                  </div>
                </div>
              </div>


          <div class="md-content">
            <article class="md-content__inner md-typeset">


                  <a href="https://github.com/ctf-wiki/ctf-wiki/blob/master/docs/crypto/blockcipher/mode/padding-oracle-attack.md" title="编辑此页" class="md-icon md-content__icon">&#xE3C9;</a>


                <p><a href="./">EN</a> | <a href="../padding-oracle-attack-zh/">ZH</a></p>
<h1 id="padding-oracle-attack">Padding Oracle Attack<a class="headerlink" href="#padding-oracle-attack" title="Permanent link">&para;</a></h1>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>Padding Oracle Attack attacks generally need to meet the following conditions</p>
<ul>
<li>Encryption Algorithm</li>
<li>Encryption algorithm using PKCS5 Padding. Of course, the way OAEP is filled in asymmetric encryption may also be affected.</li>
<li>The grouping mode is CBC mode.</li>
<li>Attacker ability</li>
<li>An attacker can intercept messages encrypted by the above encryption algorithm.</li>
<li>The attacker can interact with the padding oracle (the server): the client sends the ciphertext to the server, and the server will use some kind of return information to inform the client whether the padding is normal.</li>
</ul>
<p>Padding Oracle Attack can achieve the following effects</p>
<ul>
<li>Decrypt any given ciphertext without knowing the key and IV.</li>
</ul>
<h2 id="principle">Principle<a class="headerlink" href="#principle" title="Permanent link">&para;</a></h2>
<p>The basic principles of the Padding Oracle Attack attack are as follows</p>
<ul>
<li>Decrypt a very long message piece by piece.</li>
<li>For each message, first decrypt the last byte of the message, then decrypt the second to last byte, and so on.</li>
</ul>
<p>Here we review the CBC</p>
<ul>
<li>Encryption</li>
</ul>
<p>$$</p>
<p>C_i=E_K(P_i \oplus C_{i-1})\</p>
<p>IV = C_0
$$</p>
<ul>
<li>Decryption</li>
</ul>
<p>$$</p>
<p>P_{i}=D_{K}(C_{i})\oplus C_{i-1}\ C_{0}=IV</p>
<p>$$</p>
<p>We mainly focus on decryption, we don&#39;t know IV and key here. Here we assume that the length of the ciphertext block is n bytes.</p>
<p>Suppose we intercepted ciphertext Y to obtain the last byte of ciphertext Y as an example for analysis. In order to obtain the content of Y, we first need to forge a piece of ciphertext F so that the last byte of the plaintext corresponding to Y can be modified. This is because if we construct the ciphertext <code>F|Y</code>, then the decryption Y is specifically
$$</p>
<p>P = D_K (Y)  oplus F
$$</p>
<p>So modify the last byte of ciphertext F, <span><span class="MathJax_Preview">F_{n}</span><script type="math/tex">F_{n}</script></span>, to modify the last byte of the plaintext corresponding to Y. The process of getting the last byte of P is given below.</p>
<ol>
<li>i=0, set each byte of F to be <strong>random byte</strong>.</li>
<li>Set <span><span class="MathJax_Preview">F_n=i \oplus 0x01</span><script type="math/tex">F_n=i \oplus 0x01</script></span></li>
<li>Send F|Y to the server. If the last byte of P is i, then the last padding is 0x01 and no error will occur. Otherwise, only the last <span><span class="MathJax_Preview">P_n \oplus i \oplus 0x01</span><script type="math/tex">P_n \oplus i \oplus 0x01</script></span> bytes of P are <span><span class="MathJax_Preview">P_n \oplus i \oplus 0x01</span><script type="math/tex">P_n \oplus i \oplus 0x01</script></span> and no error will be reported. <strong> Also, note that the padding bytes can only be 0 to n. </strong> Therefore, if you want to make the error in the case of F randomly and satisfy the padding byte size, the probability is small**. So in the case of no error on the server side, we can think that we did get the correct bytes.</li>
<li>In the event of an error, i=i+1, jump to 2.</li>
</ol>
<p>After getting the last byte of P, we can continue to get the second-to-last byte of P. In this case, we need to set <span><span class="MathJax_Preview">F_n=P_n\oplus 0x02</span><script type="math/tex">F_n=P_n\oplus 0x02</script></span> and set <span><span class="MathJax_Preview">F_{n-1}=i \oplus 0x02</span><script type="math/tex">F_{n-1}=i \oplus 0x02</script></span> to enumerate i.</p>
<p>So, in summary, Padding Oracle Attack is actually a method of attack with a high probability of success.</p>
<p>However, it&#39;s important to note that some of the real-world problems that are often encountered are not the standard Padding Oracle Attack mode, and we often need to make some changes.</p>
<h2 id="2017-hitcon-secret-server">2017 HITCON Secret Server<a class="headerlink" href="#2017-hitcon-secret-server" title="Permanent link">&para;</a></h2>
<h3 id="analysis">Analysis<a class="headerlink" href="#analysis" title="Permanent link">&para;</a></h3>
<p>The encryption used in the program is AES CBC, which uses padding similar to PKCS5.</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">pad</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>

    <span class="n">pad_length</span> <span class="o">=</span> <span class="mi">16</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span><span class="o">%</span><span class="mi">16</span>

    <span class="k">return</span> <span class="n">msg</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="n">pad_length</span><span class="p">)</span><span class="o">*</span><span class="n">pad_length</span>



<span class="k">def</span> <span class="nf">unpad</span> <span class="p">(</span><span class="n">msg</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">msg</span><span class="p">[:</span><span class="o">-</span><span class="nb">ord</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])]</span>
</code></pre></div>

<p>However, in each unpad, no detection is performed, but the unpad is directly executed.</p>
<p>Among them, it should be noted that the function that interacts with the user each time is</p>
<ul>
<li><code>send_msg</code> , accepts the user&#39;s plaintext, encrypts it with a fixed <code>2jpmLoSsOlQrqyqE</code>, and outputs the encrypted result.</li>
<li><code>recv_msg</code> , accepts the user&#39;s IV and ciphertext, decrypts the ciphertext, and returns. There will be different actions depending on the results returned.</li>
</ul>
<div class="codehilite"><pre><span></span><code>            <span class="n">msg</span> <span class="o">=</span> <span class="n">recv_msg</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;exit-here&#39;</span><span class="p">):</span>

                <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">msg</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;get-flag&#39;</span><span class="p">):</span>

                <span class="n">send_msg</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">msg</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;get-md5&#39;</span><span class="p">):</span>

                <span class="n">send_msg</span><span class="p">(</span><span class="n">MD5</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="mi">7</span><span class="p">:])</span><span class="o">.</span><span class="n">digest</span><span class="p">())</span>

            <span class="k">elif</span> <span class="n">msg</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;get-time&#39;</span><span class="p">):</span>

                <span class="n">send_msg</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()))</span>

            <span class="k">elif</span> <span class="n">msg</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;get-sha1&#39;</span><span class="p">):</span>

                <span class="n">send_msg</span><span class="p">(</span><span class="n">SHA</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="mi">8</span><span class="p">:])</span><span class="o">.</span><span class="n">digest</span><span class="p">())</span>

            <span class="k">elif</span> <span class="n">msg</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;get-sha256&#39;</span><span class="p">):</span>

                <span class="n">send_msg</span><span class="p">(</span><span class="n">SHA256</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="mi">10</span><span class="p">:])</span><span class="o">.</span><span class="n">digest</span><span class="p">())</span>

            <span class="k">elif</span> <span class="n">msg</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;get-hmac&#39;</span><span class="p">):</span>

                <span class="n">send_msg</span><span class="p">(</span><span class="n">HMAC</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="mi">8</span><span class="p">:])</span><span class="o">.</span><span class="n">digest</span><span class="p">())</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="n">send_msg</span><span class="p">(</span><span class="s1">&#39;command not found&#39;</span><span class="p">)</span>
</code></pre></div>

<h3 id="main-vulnerabilities">Main Vulnerabilities<a class="headerlink" href="#main-vulnerabilities" title="Permanent link">&para;</a></h3>
<p>Here we briefly summarize the parts we have.</p>
<ul>
<li>Encryption</li>
<li>The IV when encrypting is fixed and known.</li>
<li>&#39;Welcome!!&#39; Encrypted result.</li>
<li>Decryption</li>
<li>We can control IV.</li>
</ul>
<p>First of all, since we know the result of the <code>Welcome!!</code> encryption, we can also control the IV in recv_msg, then according to the decryption process
$$</p>
<p>P_{i}=D_{K}(C_{i})\oplus C_{i-1}\ C_{0}=IV</p>
<p>$$</p>
<p>If we enter the encrypted result of <code>Welcome!!</code> into recv_msg, the result of direct decryption is <code>(Welcome!!+&amp;#39;\x07&amp;#39;*7) xor iv</code>, if we <strong> properly control the decryption process In the iv</strong> passed, then we can control the decrypted result. In other words, we can execute any of the commands described above**. Thus, we can also know the result of the <code>flag</code> decryption.</p>
<p>Secondly, on the above basis, if we add the custom IV and Welcome encrypted result after any ciphertext C and pass it to recv_msg as input, then we can control the last byte of the message after decryption. <strong>So due to the unpad operation, we can control the length of the decrypted message to be reduced from 0 to 255</strong>.</p>
<h3 id="using-ideas">Using ideas<a class="headerlink" href="#using-ideas" title="Permanent link">&para;</a></h3>
<p>Basic use ideas are as follows</p>
<p>Bypass proof of work
2. Obtain the encrypted flag according to the way you execute any command.
3. Since the beginning of the flag is <code>hitcon{</code>, there are 7 bytes in total, so we can still control the iv to make the first 7 bytes after decryption the specified byte. This allows us to execute the <code>get-md5</code> command on the decrypted message. According to the unpad operation, we can control the decrypted message exactly at the first few bytes of the message. So we can start controlling the decrypted message as <code>hitcon{x</code>, that is, only one byte after <code>hitcon{</code>. This will result in an encrypted result with a one-byte hash. Similarly, we can also get the result of the encryption with a byte hash.
4. In this case, we can blast locally byte by byte, calculate the corresponding <code>md5</code>, and then use the arbitrary command execution mode to control the decrypted plaintext to any specified command. If the control is unsuccessful, it means that the byte is incorrect. , need to blast again; if it is correct, then you can directly execute the corresponding command.</p>
<p>The specific code is as follows</p>
<div class="codehilite"><pre><span></span><code><span class="c1">#coding=utf-8</span>

<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">import</span> <span class="nn">base64</span><span class="o">,</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">random</span><span class="o">,</span> <span class="nn">string</span>

<span class="kn">from</span> <span class="nn">Crypto.Cipher</span> <span class="kn">import</span> <span class="n">AES</span>

<span class="kn">from</span> <span class="nn">Crypto.Hash</span> <span class="kn">import</span> <span class="n">SHA256</span><span class="p">,</span> <span class="n">MD5</span>

<span class="c1">#context.log_level = &#39;debug&#39;</span>

<span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;REMOTE&#39;</span><span class="p">]:</span>

    <span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;52.193.157.19&#39;</span><span class="p">,</span> <span class="mi">9999</span><span class="p">)</span>

<span class="k">else</span><span class="p">:</span>

    <span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">7777</span><span class="p">)</span>





<span class="k">def</span> <span class="nf">strxor</span><span class="p">(</span><span class="n">str1</span><span class="p">,</span> <span class="n">str2</span><span class="p">):</span>

    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span> <span class="o">^</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c2</span><span class="p">))</span> <span class="k">for</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">str1</span><span class="p">,</span> <span class="n">str2</span><span class="p">)])</span>





<span class="k">def</span> <span class="nf">pad</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>

    <span class="n">pad_length</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="o">%</span> <span class="mi">16</span>

    <span class="k">return</span> <span class="n">msg</span> <span class="o">+</span> <span class="nb">chr</span><span class="p">(</span><span class="n">pad_length</span><span class="p">)</span> <span class="o">*</span> <span class="n">pad_length</span>





<span class="k">def</span> <span class="nf">unpad</span> <span class="p">(</span><span class="n">msg</span><span class="p">):</span>
<span class="n">Return</span> <span class="n">msg</span><span class="p">[:</span><span class="o">-</span><span class="nb">ord</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])]</span> <span class="c1"># Remove the pad</span>




<span class="k">def</span> <span class="nf">flipplain</span><span class="p">(</span><span class="n">oldplain</span><span class="p">,</span> <span class="n">newplain</span><span class="p">,</span> <span class="n">iv</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;flip oldplain to new plain, return proper iv&quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">strxor</span><span class="p">(</span><span class="n">strxor</span><span class="p">(</span><span class="n">oldplain</span><span class="p">,</span> <span class="n">newplain</span><span class="p">),</span> <span class="n">iv</span><span class="p">)</span>





<span class="k">def</span> <span class="nf">bypassproof</span><span class="p">():</span>

    <span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;SHA256(XXXX+&#39;</span><span class="p">)</span>

    <span class="n">lastdata</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39; == &#39;</span><span class="p">)</span>

    <span class="n">digest</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Give me XXXX:&#39;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>



    <span class="k">def</span> <span class="nf">proof</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">SHA256</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="n">lastdata</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span> <span class="o">==</span> <span class="n">digest</span>



<span class="n">data</span> <span class="o">=</span> <span class="n">pwnlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">iters</span><span class="o">.</span><span class="n">mbruteforce</span> <span class="p">(</span>
        <span class="n">proof</span><span class="p">,</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;fixed&#39;</span><span class="p">)</span>

    <span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;Done!</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>





<span class="n">iv_encrypt</span> <span class="o">=</span> <span class="s1">&#39;2jpmLoSsOlQrqyqE&#39;</span>





<span class="k">def</span> <span class="nf">getmd5enc</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">cipher_flag</span><span class="p">,</span> <span class="n">cipher_welcome</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;return encrypt( md5( flag[7:7+i] ) )&quot;&quot;&quot;</span>

    <span class="c1">## keep iv[7:] do not change, so decrypt won&#39;t change</span>

<span class="n">new_iv</span> <span class="o">=</span> <span class="n">flipplain</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">hitcon</span> <span class="p">{</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="o">.</span> <span class="n">bright</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">x00</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;),</span> <span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">get</span><span class="o">-</span><span class="n">md5</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span> <span class="o">.</span><span class="n">light</span> <span class="p">(</span>
        <span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">),</span> <span class="n">iv_encrypt</span><span class="p">)</span>

    <span class="n">payload</span> <span class="o">=</span> <span class="n">new_iv</span> <span class="o">+</span> <span class="n">cipher_flag</span>

    <span class="c1">## calculate the proper last byte number</span>

    <span class="n">last_byte_iv</span> <span class="o">=</span> <span class="n">flipplain</span><span class="p">(</span>

        <span class="n">pad</span><span class="p">(</span><span class="s2">&quot;Welcome!!&quot;</span><span class="p">),</span>

        <span class="s2">&quot;a&quot;</span> <span class="o">*</span> <span class="mi">15</span> <span class="o">+</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cipher_flag</span><span class="p">)</span> <span class="o">+</span> <span class="mi">16</span> <span class="o">+</span> <span class="mi">16</span> <span class="o">-</span> <span class="p">(</span><span class="mi">7</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">iv_encrypt</span><span class="p">)</span>

    <span class="n">payload</span> <span class="o">+=</span> <span class="n">last_byte_iv</span> <span class="o">+</span> <span class="n">cipher_welcome</span>

    <span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">payload</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>





<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>

    <span class="n">bypassproof</span><span class="p">()</span>



    <span class="c1"># result of encrypted Welcome!!</span>

    <span class="n">cipher</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">cipher_welcome</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">cipher</span><span class="p">)[</span><span class="mi">16</span><span class="p">:]</span>

    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;cipher welcome is : &quot;</span> <span class="o">+</span> <span class="n">cipher_welcome</span><span class="p">)</span>



    <span class="c1"># execute get-flag</span>

    <span class="n">get_flag_iv</span> <span class="o">=</span> <span class="n">flipplain</span><span class="p">(</span><span class="n">pad</span><span class="p">(</span><span class="s2">&quot;Welcome!!&quot;</span><span class="p">),</span> <span class="n">pad</span><span class="p">(</span><span class="s2">&quot;get-flag&quot;</span><span class="p">),</span> <span class="n">iv_encrypt</span><span class="p">)</span>

    <span class="n">payload</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">get_flag_iv</span> <span class="o">+</span> <span class="n">cipher_welcome</span><span class="p">)</span>

    <span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>

    <span class="n">cipher</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">cipher_flag</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">cipher</span><span class="p">)[</span><span class="mi">16</span><span class="p">:]</span>

    <span class="n">flaglen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cipher_flag</span><span class="p">)</span>

    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;cipher flag is : &quot;</span> <span class="o">+</span> <span class="n">cipher_flag</span><span class="p">)</span>



    <span class="c1"># get command not found cipher</span>

    <span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">iv_encrypt</span> <span class="o">+</span> <span class="n">cipher_welcome</span><span class="p">))</span>

    <span class="n">cipher_notfound</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>



    <span class="n">flag</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="c1"># brute force for every byte of flag</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">flaglen</span> <span class="o">-</span> <span class="mi">7</span><span class="p">):</span>

        <span class="n">md5_indexi</span> <span class="o">=</span> <span class="n">getmd5enc</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">cipher_flag</span><span class="p">,</span> <span class="n">cipher_welcome</span><span class="p">)</span>

<span class="n">md5_indexi</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span> <span class="p">(</span><span class="n">md5_indexi</span><span class="p">)</span> <span class="p">[</span><span class="mi">16</span><span class="p">:]</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;get encrypt(md5(flag[7:7+i])): &quot;</span> <span class="o">+</span> <span class="n">md5_indexi</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">guess</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>

            <span class="c1"># locally compute md5 hash</span>

            <span class="n">guess_md5</span> <span class="o">=</span> <span class="n">MD5</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">flag</span> <span class="o">+</span> <span class="nb">chr</span><span class="p">(</span><span class="n">guess</span><span class="p">))</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>

            <span class="c1"># try to null out the md5 plaintext and execute a command</span>

            <span class="n">payload</span> <span class="o">=</span> <span class="n">flipplain</span><span class="p">(</span><span class="n">guess_md5</span><span class="p">,</span> <span class="s1">&#39;get-time&#39;</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x01</span><span class="s1">&#39;</span><span class="p">),</span>

                                <span class="n">iv_encrypt</span><span class="p">)</span>

            <span class="n">payload</span> <span class="o">+=</span> <span class="n">md5_indexi</span>

            <span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">payload</span><span class="p">))</span>

            <span class="n">res</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># if we receive the block for &#39;command not found&#39;, the hash was wrong</span>

            <span class="k">if</span> <span class="n">res</span> <span class="o">==</span> <span class="n">cipher_notfound</span><span class="p">:</span>

                <span class="nb">print</span> <span class="s1">&#39;Guess </span><span class="si">{}</span><span class="s1"> is wrong.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">guess</span><span class="p">)</span>

            <span class="c1"># otherwise we correctly guessed the hash and the command was executed</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="nb">print</span> <span class="s1">&#39;Found!&#39;</span>

                <span class="n">flag</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">guess</span><span class="p">)</span>

                <span class="nb">print</span> <span class="s1">&#39;Flag so far:&#39;</span><span class="p">,</span> <span class="n">flag</span>

                <span class="k">break</span>





<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>

    <span class="n">main</span><span class="p">()</span>
</code></pre></div>

<p>The final result is as follows</p>
<div class="codehilite"><pre><span></span><code>Flag so far: Paddin9_15_ve3y_h4rd__!!<span class="o">}</span><span class="se">\x</span><span class="m">10</span><span class="se">\x</span><span class="m">10</span><span class="se">\x</span><span class="m">10</span><span class="se">\x</span><span class="m">10</span><span class="se">\x</span><span class="m">10</span><span class="se">\x</span><span class="m">10</span><span class="se">\x</span><span class="m">10</span><span class="se">\x</span><span class="m">10</span><span class="se">\x</span><span class="m">10</span><span class="se">\x</span><span class="m">10</span><span class="se">\x</span><span class="m">10</span><span class="se">\x</span><span class="m">10</span><span class="se">\x</span><span class="m">10</span><span class="se">\x</span><span class="m">10</span><span class="se">\x</span><span class="m">10</span><span class="se">\x</span><span class="m">10</span>
</code></pre></div>

<h2 id="2017-hitcon-secret-server-revenge">2017 HITCON Secret Server Revenge<a class="headerlink" href="#2017-hitcon-secret-server-revenge" title="Permanent link">&para;</a></h2>
<h3 id="description">Description<a class="headerlink" href="#description" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code>The password of zip is the flag of &quot;Secret Server&quot;
</code></pre></div>

<h3 id="analysis_1">Analysis<a class="headerlink" href="#analysis_1" title="Permanent link">&para;</a></h3>
<p>This program continues with the above program, but this time a simple modification</p>
<ul>
<li>The iv of the encryption algorithm is unknown, but can be derived from the message encrypted by Welcome.</li>
<li>The program has a 56-byte token.</li>
<li>The program can perform up to 340 operations, so the above blasting is naturally not feasible</li>
</ul>
<p>The general process of the program is as follows</p>
<p>After proof of work
2. Send &quot;Welcome!!&quot; encrypted message
3. In 340 operations, you need to guess the value of the token and then automatically output the flag.</p>
<h3 id="vulnerability">Vulnerability<a class="headerlink" href="#vulnerability" title="Permanent link">&para;</a></h3>
<p>Of course, the loopholes in the previous topic still exist in this topic, namely</p>
<ol>
<li>Execute the given command arbitrarily</li>
<li>Length truncation</li>
</ol>
<h3 id="using-ideas_1">Using ideas<a class="headerlink" href="#using-ideas_1" title="Permanent link">&para;</a></h3>
<p>Due to the limitation of the number of 340, although we can still get the value of <code>md5(token[:i])</code> encrypted (<strong> here we need to pay attention to this part of the encryption is exactly 32 bytes, the first 16 bytes are The value after md5 is encrypted, the next 16 bytes are completely filled with encrypted bytes.</strong> Here <code>md5(token[:i])</code> refers specifically to the first 16 bytes.). However, we can&#39;t blast 256 times again in order to get a character.</p>
<p>Since it is not possible to blast, is it possible to get the size of one byte at a time? Here, let&#39;s take a look at the information that the program may leak.</p>
<ol>
<li>The encrypted value of the md5 value of some messages. Here we can get the encrypted value of <code>md5(token[:i])</code>.</li>
<li>Unpad will unmap the decrypted message each time. This byte is determined based on the last byte of the decrypted message. If we can calculate the size of this byte, then we may know the value of a byte.</li>
</ol>
<p>Here we delve into the information leak of unpad. If we put the encryption IV and <code>encrypt(md5(token[:i]))</code> after a ciphertext C to form <code>C|IV|encrypt(md5(token[:i]))</code>, then decrypt The last plaintext block of the outgoing message is <code>md5(token[:i])</code>. Furthermore, in the unpad, the last byte (0-255) of <code>md5(token[:i])</code> is used for unpad, and then the specified command (such as md5) is executed on the string after the unpad. Then, if we <strong> pre-configure some hashed samples after the message hash, and then compare the results of the above execution with the sample, if they are the same, then we can basically determine the <code>md5(token[:i])</code> * * Last byte</strong>. However, if the last byte of <code>md5(token[:i])</code> is less than 16, then some values in md5 will be used in unpad, and this part of the value, due to <code>token[:i] for different lengths</code> Almost all will not be the same. So special handling may be required.</p>
<p>We already know the key to this problem, which is to generate a sample of the encrypted result corresponding to the size of the unpad byte, in order to facilitate the lookup table.</p>
<p>The specific use ideas are as follows</p>
<ol>
<li>Bypass proof of work.</li>
<li>Get the token encrypted result <code>token_enc</code> , which will add 7 bytes <code>&amp;quot;token: &amp;quot;</code> in front of the token. Therefore, the length after encryption is 64.</li>
<li>Get the result of <code>encrypt(md5(token[:i]))</code>, which is a total of 57, including the padding of the last token.</li>
<li>Construct a sample that corresponds to the size of the unpad. Here we construct the ciphertext <code>token_enc|padding|IV_indexi|welcome_enc</code>. Since <code>IV_indexi</code> is to modify the last byte of the last plaintext block, the byte is in the process of being changed. If we want to get some fixed byte hashes, this part can&#39;t be added naturally. Therefore, the size of the unpad ranges from 17 to 255 when the sample is generated here. If the last byte of <code>md5(token[:i])</code> is less than 17 at the end of the test, there will be some unknown samples. A natural idea is that we directly get 255-17+1 such multiple samples, however, if we do this, according to the number of times above 340 (255-17+1+57+56&gt;340), we obviously can&#39;t Get all the bytes to the token. So here we need to find ways to reuse some content, here we choose to reuse the result of <code>encrypt(md5(token[:i]))</code>. Then we need to ensure that the number of times is sufficient on the one hand, and on the other hand, the previous results can be reused. Here we set the unpad loop to 17 to 208, and make the unpad more than 208 when we just unpad to where we can reuse. It should be noted here that when the last byte of <code>md5(token[:i])</code> is 0, all decrypted plaintext unpad will be dropped, so the ciphertext of command not found will appear.</li>
<li>Construct the ciphertext <code>token_enc|padding|IV|encrypt(md5(token[:i]))</code> again, then use the last byte of <code>md5(token[:i])</code> for unpad when decrypting. If this byte is not less than 17 or 0, it can be processed. If this byte is less than 17, then obviously, the result of the last md5 returned to the user is not within the sample range, then we modify the highest bit of its last byte so that it can fall within the sample range after the unpad. In this way, we can guess the last byte of <code>md5(token[:i])</code>.</li>
<li>After guessing the last byte of <code>md5(token[:i])</code>, we can brute 256 times locally and find out that all hashes are at the end of <code>md5(token[:i])</code> The last byte of the character.</li>
<li>However, in the sixth step, for a <code>md5(token[:i])</code> we may find multiple alternative characters because we only need to make the last byte of the given byte.</li>
<li>So, the question is, how do you delete some extra candidate strings? Here I chose a small trick, which enumerates the padding of the token at the same time as the byte-by-byte enumeration. Since padding is fixed at 0x01, we only need to filter out all tokens that are not 0x01 at the end.</li>
</ol>
<p>Here, the <code>sleep</code> in the code is commented out during the test. In order to speed up the interaction. Use the code as follows</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">import</span> <span class="nn">base64</span><span class="o">,</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">random</span><span class="o">,</span> <span class="nn">string</span>

<span class="kn">from</span> <span class="nn">Crypto.Cipher</span> <span class="kn">import</span> <span class="n">AES</span>

<span class="kn">from</span> <span class="nn">Crypto.Hash</span> <span class="kn">import</span> <span class="n">SHA256</span><span class="p">,</span> <span class="n">MD5</span>

<span class="c1">#context.log_level = &#39;debug&#39;</span>



<span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">7777</span><span class="p">)</span>





<span class="k">def</span> <span class="nf">strxor</span><span class="p">(</span><span class="n">str1</span><span class="p">,</span> <span class="n">str2</span><span class="p">):</span>

    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span> <span class="o">^</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c2</span><span class="p">))</span> <span class="k">for</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">str1</span><span class="p">,</span> <span class="n">str2</span><span class="p">)])</span>





<span class="k">def</span> <span class="nf">pad</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>

    <span class="n">pad_length</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="o">%</span> <span class="mi">16</span>

    <span class="k">return</span> <span class="n">msg</span> <span class="o">+</span> <span class="nb">chr</span><span class="p">(</span><span class="n">pad_length</span><span class="p">)</span> <span class="o">*</span> <span class="n">pad_length</span>





<span class="k">def</span> <span class="nf">unpad</span> <span class="p">(</span><span class="n">msg</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">msg</span><span class="p">[:</span><span class="o">-</span><span class="nb">ord</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])]</span>  <span class="c1"># remove pad</span>





<span class="k">def</span> <span class="nf">flipplain</span><span class="p">(</span><span class="n">oldplain</span><span class="p">,</span> <span class="n">newplain</span><span class="p">,</span> <span class="n">iv</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;flip oldplain to new plain, return proper iv&quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">strxor</span><span class="p">(</span><span class="n">strxor</span><span class="p">(</span><span class="n">oldplain</span><span class="p">,</span> <span class="n">newplain</span><span class="p">),</span> <span class="n">iv</span><span class="p">)</span>





<span class="k">def</span> <span class="nf">bypassproof</span><span class="p">():</span>

    <span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;SHA256(XXXX+&#39;</span><span class="p">)</span>

    <span class="n">lastdata</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39; == &#39;</span><span class="p">)</span>

    <span class="n">digest</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Give me XXXX:&#39;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>



    <span class="k">def</span> <span class="nf">proof</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">SHA256</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="n">lastdata</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span> <span class="o">==</span> <span class="n">digest</span>



<span class="n">data</span> <span class="o">=</span> <span class="n">pwnlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">iters</span><span class="o">.</span><span class="n">mbruteforce</span> <span class="p">(</span>
        <span class="n">proof</span><span class="p">,</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;fixed&#39;</span><span class="p">)</span>

    <span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>





<span class="k">def</span> <span class="nf">sendmsg</span><span class="p">(</span><span class="n">iv</span><span class="p">,</span> <span class="n">cipher</span><span class="p">):</span>

    <span class="n">payload</span> <span class="o">=</span> <span class="n">iv</span> <span class="o">+</span> <span class="n">cipher</span>

    <span class="n">payload</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>

    <span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>





<span class="k">def</span> <span class="nf">recvmsg</span><span class="p">():</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">data</span><span class="p">[:</span><span class="mi">16</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">16</span><span class="p">:]</span>





<span class="k">def</span> <span class="nf">getmd5enc</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">cipher_token</span><span class="p">,</span> <span class="n">cipher_welcome</span><span class="p">,</span> <span class="n">iv</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;return encrypt( md5( token[:i+1] ) )&quot;&quot;&quot;</span>

    <span class="c1">## keep iv[7:] do not change, so decrypt msg[7:] won&#39;t change</span>

<span class="n">get_md5_iv</span> <span class="o">=</span> <span class="n">flipplain</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">token</span><span class="p">:</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span> <span class="o">.</span><span class="n">lit</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">x00</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;),</span> <span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">get</span><span class="o">-</span><span class="n">md5</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="o">.</span>
        <span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">),</span> <span class="n">iv</span><span class="p">)</span>

    <span class="n">payload</span> <span class="o">=</span> <span class="n">cipher_token</span>

    <span class="c1">## calculate the proper last byte number</span>

    <span class="n">last_byte_iv</span> <span class="o">=</span> <span class="n">flipplain</span><span class="p">(</span>

        <span class="n">pad</span><span class="p">(</span><span class="s2">&quot;Welcome!!&quot;</span><span class="p">),</span>

        <span class="s2">&quot;a&quot;</span> <span class="o">*</span> <span class="mi">15</span> <span class="o">+</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cipher_token</span><span class="p">)</span> <span class="o">+</span> <span class="mi">16</span> <span class="o">+</span> <span class="mi">16</span> <span class="o">-</span> <span class="p">(</span><span class="mi">7</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">iv</span><span class="p">)</span>

    <span class="n">payload</span> <span class="o">+=</span> <span class="n">last_byte_iv</span> <span class="o">+</span> <span class="n">cipher_welcome</span>

    <span class="n">sendmsg</span><span class="p">(</span><span class="n">get_md5_iv</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">recvmsg</span><span class="p">()</span>





<span class="k">def</span> <span class="nf">get_md5_token_indexi</span><span class="p">(</span><span class="n">iv_encrypt</span><span class="p">,</span> <span class="n">cipher_welcome</span><span class="p">,</span> <span class="n">cipher_token</span><span class="p">):</span>

    <span class="n">md5_token_idxi</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cipher_token</span><span class="p">)</span> <span class="o">-</span> <span class="mi">7</span><span class="p">):</span>

        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;idx i: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

        <span class="n">_</span><span class="p">,</span> <span class="n">md5_indexi</span> <span class="o">=</span> <span class="n">getmd5enc</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">cipher_token</span><span class="p">,</span> <span class="n">cipher_welcome</span><span class="p">,</span> <span class="n">iv_encrypt</span><span class="p">)</span>

<span class="k">assert</span> <span class="p">(</span><span class="n">only</span> <span class="p">(</span><span class="n">md5_indexi</span><span class="p">)</span> <span class="o">==</span> <span class="mi">32</span><span class="p">)</span>        <span class="c1"># remove the last 16 byte for padding</span>

        <span class="n">md5_token_idxi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">md5_indexi</span><span class="p">[:</span><span class="mi">16</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">md5_token_idxi</span>





<span class="k">def</span> <span class="nf">doin</span><span class="p">(</span><span class="n">unpadcipher</span><span class="p">,</span> <span class="n">md5map</span><span class="p">,</span> <span class="n">candidates</span><span class="p">,</span> <span class="n">flag</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">unpadcipher</span> <span class="ow">in</span> <span class="n">md5map</span><span class="p">:</span>

        <span class="n">lastbyte</span> <span class="o">=</span> <span class="n">md5map</span><span class="p">[</span><span class="n">unpadcipher</span><span class="p">]</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="n">lastbyte</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">flag</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

        <span class="n">lastbyte</span> <span class="o">^=</span> <span class="mh">0x80</span>

    <span class="n">newcandidates</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">:</span>

        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">MD5</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="nb">chr</span><span class="p">(</span><span class="n">c</span><span class="p">))</span><span class="o">.</span><span class="n">digest</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="nb">chr</span><span class="p">(</span><span class="n">lastbyte</span><span class="p">):</span>

                <span class="n">newcandidates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="nb">chr</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>

    <span class="n">candidates</span> <span class="o">=</span> <span class="n">newcandidates</span>

    <span class="nb">print</span> <span class="n">candidates</span>

    <span class="k">return</span> <span class="n">candidates</span>





<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>

    <span class="n">bypassproof</span><span class="p">()</span>



    <span class="c1"># result of encrypted Welcome!!</span>

    <span class="n">iv_encrypt</span><span class="p">,</span> <span class="n">cipher_welcome</span> <span class="o">=</span> <span class="n">recvmsg</span><span class="p">()</span>

    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;cipher welcome is : &quot;</span> <span class="o">+</span> <span class="n">cipher_welcome</span><span class="p">)</span>



    <span class="c1"># execute get-token</span>

    <span class="n">get_token_iv</span> <span class="o">=</span> <span class="n">flipplain</span><span class="p">(</span><span class="n">pad</span><span class="p">(</span><span class="s2">&quot;Welcome!!&quot;</span><span class="p">),</span> <span class="n">pad</span><span class="p">(</span><span class="s2">&quot;get-token&quot;</span><span class="p">),</span> <span class="n">iv_encrypt</span><span class="p">)</span>

    <span class="n">sendmsg</span><span class="p">(</span><span class="n">get_token_iv</span><span class="p">,</span> <span class="n">cipher_welcome</span><span class="p">)</span>

    <span class="n">_</span><span class="p">,</span> <span class="n">cipher_token</span> <span class="o">=</span> <span class="n">recvmsg</span><span class="p">()</span>

<span class="n">token_len</span> <span class="o">=</span> <span class="n">only</span> <span class="p">(</span><span class="n">cipher_token</span><span class="p">)</span>
    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;cipher token is : &quot;</span> <span class="o">+</span> <span class="n">cipher_token</span><span class="p">)</span>



    <span class="c1"># get command not found cipher</span>

    <span class="n">sendmsg</span><span class="p">(</span><span class="n">iv_encrypt</span><span class="p">,</span> <span class="n">cipher_welcome</span><span class="p">)</span>

    <span class="n">_</span><span class="p">,</span> <span class="n">cipher_notfound</span> <span class="o">=</span> <span class="n">recvmsg</span><span class="p">()</span>



    <span class="c1"># get encrypted(token[:i+1]),57 times</span>

    <span class="n">md5_token_idx_list</span> <span class="o">=</span> <span class="n">get_md5_token_indexi</span><span class="p">(</span><span class="n">iv_encrypt</span><span class="p">,</span> <span class="n">cipher_welcome</span><span class="p">,</span>

                                              <span class="n">cipher_token</span><span class="p">)</span>

    <span class="c1"># get md5map for each unpadsize, 209-17 times</span>

    <span class="c1"># when upadsize&gt;208, it will unpad ciphertoken</span>

    <span class="c1"># then we can reuse</span>

<span class="n">md5map</span> <span class="o">=</span> <span class="nb">dict</span> <span class="p">()</span>
    <span class="k">for</span> <span class="n">unpadsize</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">209</span><span class="p">):</span>

        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;get unpad size </span><span class="si">{}</span><span class="s2"> cipher&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">unpadsize</span><span class="p">))</span>

<span class="n">get_md5_iv</span> <span class="o">=</span> <span class="n">flipplain</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">token</span><span class="p">:</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span> <span class="o">.</span><span class="n">lit</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">x00</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;),</span> <span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">get</span><span class="o">-</span><span class="n">md5</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="o">.</span>
            <span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">),</span> <span class="n">iv_encrypt</span><span class="p">)</span>

        <span class="c1">## padding 16*11 bytes</span>

        <span class="n">padding</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">*</span> <span class="mi">11</span> <span class="o">*</span> <span class="s2">&quot;a&quot;</span>

        <span class="c1">## calculate the proper last byte number, only change the last byte</span>

        <span class="c1">## set last_byte_iv = iv_encrypted[:15] | proper byte</span>

        <span class="n">last_byte_iv</span> <span class="o">=</span> <span class="n">flipplain</span><span class="p">(</span>

            <span class="n">pad</span><span class="p">(</span><span class="s2">&quot;Welcome!!&quot;</span><span class="p">),</span>

            <span class="n">pad</span><span class="p">(</span><span class="s2">&quot;Welcome!!&quot;</span><span class="p">)[:</span><span class="mi">15</span><span class="p">]</span> <span class="o">+</span> <span class="nb">chr</span><span class="p">(</span><span class="n">unpadsize</span><span class="p">),</span> <span class="n">iv_encrypt</span><span class="p">)</span>

        <span class="n">cipher</span> <span class="o">=</span> <span class="n">cipher_token</span> <span class="o">+</span> <span class="n">padding</span> <span class="o">+</span> <span class="n">last_byte_iv</span> <span class="o">+</span> <span class="n">cipher_welcome</span>

        <span class="n">sendmsg</span><span class="p">(</span><span class="n">get_md5_iv</span><span class="p">,</span> <span class="n">cipher</span><span class="p">)</span>

        <span class="n">_</span><span class="p">,</span> <span class="n">unpadcipher</span> <span class="o">=</span> <span class="n">recvmsg</span><span class="p">()</span>

        <span class="n">md5map</span><span class="p">[</span><span class="n">unpadcipher</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpadsize</span>



    <span class="c1"># reuse encrypted(token[:i+1])</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">209</span><span class="p">,</span> <span class="mi">256</span><span class="p">):</span>

        <span class="n">target</span> <span class="o">=</span> <span class="n">md5_token_idx_list</span><span class="p">[</span><span class="mi">56</span> <span class="o">-</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">209</span><span class="p">)]</span>

        <span class="n">md5map</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>



    <span class="n">candidates</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span>

    <span class="c1"># get the byte token[i], only 56 byte</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">token_len</span> <span class="o">-</span> <span class="mi">7</span><span class="p">):</span>

        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;get token[</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

<span class="n">get_md5_iv</span> <span class="o">=</span> <span class="n">flipplain</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">token</span><span class="p">:</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span> <span class="o">.</span><span class="n">lit</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">x00</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;),</span> <span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">get</span><span class="o">-</span><span class="n">md5</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="o">.</span>
            <span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">),</span> <span class="n">iv_encrypt</span><span class="p">)</span>

        <span class="c1">## padding 16*11 bytes</span>

        <span class="n">padding</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">*</span> <span class="mi">11</span> <span class="o">*</span> <span class="s2">&quot;a&quot;</span>

        <span class="n">cipher</span> <span class="o">=</span> <span class="n">cipher_token</span> <span class="o">+</span> <span class="n">padding</span> <span class="o">+</span> <span class="n">iv_encrypt</span> <span class="o">+</span> <span class="n">md5_token_idx_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="n">sendmsg</span><span class="p">(</span><span class="n">get_md5_iv</span><span class="p">,</span> <span class="n">cipher</span><span class="p">)</span>

        <span class="n">_</span><span class="p">,</span> <span class="n">unpadcipher</span> <span class="o">=</span> <span class="n">recvmsg</span><span class="p">()</span>

        <span class="c1"># already in or md5[token[:i]][-1]=&#39;\x00&#39;</span>

        <span class="k">if</span> <span class="n">unpadcipher</span> <span class="ow">in</span> <span class="n">md5map</span> <span class="ow">or</span> <span class="n">unpadcipher</span> <span class="o">==</span> <span class="n">cipher_notfound</span><span class="p">:</span>

            <span class="n">candidates</span> <span class="o">=</span> <span class="n">doin</span><span class="p">(</span><span class="n">unpadcipher</span><span class="p">,</span> <span class="n">md5map</span><span class="p">,</span> <span class="n">candidates</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

<span class="n">log</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">unpad</span> <span class="n">size</span> <span class="mi">1</span><span class="o">-</span><span class="mi">16</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;)</span>
            <span class="c1"># flip most significant bit of last byte to move it in a good range</span>

            <span class="n">cipher</span> <span class="o">=</span> <span class="n">cipher</span><span class="p">[:</span><span class="o">-</span><span class="mi">17</span><span class="p">]</span> <span class="o">+</span> <span class="n">strxor</span><span class="p">(</span><span class="n">cipher</span><span class="p">[</span><span class="o">-</span><span class="mi">17</span><span class="p">],</span> <span class="s1">&#39;</span><span class="se">\x80</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">cipher</span><span class="p">[</span><span class="o">-</span><span class="mi">16</span><span class="p">:]</span>

            <span class="n">sendmsg</span><span class="p">(</span><span class="n">get_md5_iv</span><span class="p">,</span> <span class="n">cipher</span><span class="p">)</span>

            <span class="n">_</span><span class="p">,</span> <span class="n">unpadcipher</span> <span class="o">=</span> <span class="n">recvmsg</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">unpadcipher</span> <span class="ow">in</span> <span class="n">md5map</span> <span class="ow">or</span> <span class="n">unpadcipher</span> <span class="o">==</span> <span class="n">cipher_notfound</span><span class="p">:</span>

                <span class="n">candidates</span> <span class="o">=</span> <span class="n">doin</span><span class="p">(</span><span class="n">unpadcipher</span><span class="p">,</span> <span class="n">md5map</span><span class="p">,</span> <span class="n">candidates</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;oh my god,,,, it must be in...&#39;</span><span class="p">)</span>

                <span class="n">exit</span><span class="p">()</span>

    <span class="nb">print</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span>

    <span class="c1"># padding 0x01</span>

    <span class="n">candidates</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="nb">chr</span><span class="p">(</span><span class="mh">0x01</span><span class="p">),</span> <span class="n">candidates</span><span class="p">)</span>

    <span class="c1"># only 56 bytes</span>

    <span class="n">candidates</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">]</span>

    <span class="nb">print</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span>

    <span class="k">assert</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">56</span><span class="p">)</span>



    <span class="c1"># check-token</span>

    <span class="n">check_token_iv</span> <span class="o">=</span> <span class="n">flipplain</span><span class="p">(</span>

        <span class="n">pad</span><span class="p">(</span><span class="s2">&quot;Welcome!!&quot;</span><span class="p">),</span> <span class="n">pad</span><span class="p">(</span><span class="s2">&quot;check-token&quot;</span><span class="p">),</span> <span class="n">iv_encrypt</span><span class="p">)</span>

    <span class="n">sendmsg</span><span class="p">(</span><span class="n">check_token_iv</span><span class="p">,</span> <span class="n">cipher_welcome</span><span class="p">)</span>

    <span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&quot;Give me the token!</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">candidates</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

    <span class="nb">print</span> <span class="n">p</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>



    <span class="n">p</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>





<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>

    <span class="n">main</span><span class="p">()</span>
</code></pre></div>

<p>The effect is as follows</p>
<div class="codehilite"><pre><span></span><code>...

<span class="m">79</span>

<span class="m">1</span>

hitcon <span class="o">{</span>uNp @ d_M3th0D_i5_am4Z1n9!<span class="o">}</span>
</code></pre></div>

<h2 id="teaser-dragon-ctf-2018-aes-128-tsb">Teaser Dragon CTF 2018 AES-128-TSB<a class="headerlink" href="#teaser-dragon-ctf-2018-aes-128-tsb" title="Permanent link">&para;</a></h2>
<p>This topic is still very interesting, the title is described as follows</p>
<div class="codehilite"><pre><span></span><code>Haven&#39;t you ever thought that GCM mode is overcomplicated and there must be a simpler way to achieve Authenticated Encryption? Here it is!



Server: aes-128-tsb.hackable.software 1337



server.py
</code></pre></div>

<p>The attachment and the final exp are found by the ctf-challenge repository.</p>
<p>The basic process of the topic is</p>
<ul>
<li>Continuously receive two strings a and b, where a is plaintext and b is ciphertext, note</li>
<li>b needs to satisfy the tail just equal to iv after decryption.</li>
<li>if a and b are equal, then</li>
<li>a is <code>gimme_flag</code> and the encrypted flag is output.</li>
<li>Otherwise, output a string of randomly encrypted strings.</li>
<li>Otherwise output a string of plain text.</li>
</ul>
<p>In addition, we can also find that there is a problem with the unpad in the title, and the specified length can be truncated.</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">unpad</span> <span class="p">(</span><span class="n">msg</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">msg</span><span class="p">:</span>

        <span class="k">return</span> <span class="s1">&#39;&#39;</span>

    <span class="k">return</span> <span class="n">msg</span><span class="p">[:</span><span class="o">-</span><span class="nb">ord</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])]</span>
</code></pre></div>

<p>In the beginning, the very straightforward idea is to enter 0 for the lengths of a and b, then you can bypass the <code>a==b</code> check to get a string of random ciphertext encrypted strings. However, it does not seem to have any effect, let&#39;s analyze the encryption process.</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">tsb_encrypt</span><span class="p">(</span><span class="n">aes</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>

    <span class="n">msg</span> <span class="o">=</span> <span class="n">pad</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">iv</span> <span class="o">=</span> <span class="n">get_random_bytes</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>

<span class="n">prev_pt</span> <span class="o">=</span> <span class="n">iv</span>
    <span class="n">prev_ct</span> <span class="o">=</span> <span class="n">iv</span>

    <span class="n">ct</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">split_by</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">iv</span><span class="p">]:</span>

        <span class="n">ct_block</span> <span class="o">=</span> <span class="n">xor</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="n">prev_pt</span><span class="p">)</span>

        <span class="n">ct_block</span> <span class="o">=</span> <span class="n">aes</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">ct_block</span><span class="p">)</span>

        <span class="n">ct_block</span> <span class="o">=</span> <span class="n">xor</span><span class="p">(</span><span class="n">ct_block</span><span class="p">,</span> <span class="n">prev_ct</span><span class="p">)</span>

        <span class="n">ct</span> <span class="o">+=</span> <span class="n">ct_block</span>

        <span class="n">prev_pt</span> <span class="o">=</span> <span class="n">block</span>

        <span class="n">prev_ct</span> <span class="o">=</span> <span class="n">ct_block</span>

    <span class="k">return</span> <span class="n">iv</span> <span class="o">+</span> <span class="n">ct</span>
</code></pre></div>

<p>Let&#39;s assume that <span><span class="MathJax_Preview">P_0=iv, C_0=iv</span><script type="math/tex">P_0=iv, C_0=iv</script></span>, then</p>
<p><span><span class="MathJax_Preview">C_i=C_{i-1}\oplus E(P_{i-1} \oplus P_i)</span><script type="math/tex">C_i=C_{i-1}\oplus E(P_{i-1} \oplus P_i)</script></span></p>
<p>So, assuming the message length is 16, similar to the length of the <code>gimme_flag</code> padding we want to get, then</p>
<p>$ C_1 = IV  oplus E (IV  oplus P_1) $</p>
<p><span><span class="MathJax_Preview">C_2=C_1 \oplus E(P_1 \oplus IV)</span><script type="math/tex">C_2=C_1 \oplus E(P_1 \oplus IV)</script></span></p>
<p>It is easy to find <span><span class="MathJax_Preview">C_2=IV</span><script type="math/tex">C_2=IV</script></span>.</p>
<p>([Pirates] (<a href="https://github.com/pberba/ctf-solutions/tree/master/20180929_teaser_dragon/aes_128_tsb">https://github.com/pberba/ctf-solutions/tree/master/20180929_teaser_dragon/aes_128_tsb</a>), the picture below is clearer</p>
<p><img alt="" src="../figure/aes-tsb-encryption.png" /></p>
<p>Conversely, if we send <code>iv+c+iv</code> to the server, we can always bypass the <code>tsb_decrypt</code> mac check.</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">tsb_decrypt</span><span class="p">(</span><span class="n">aes</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>

    <span class="n">iv</span><span class="p">,</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[:</span><span class="mi">16</span><span class="p">],</span> <span class="n">msg</span><span class="p">[</span><span class="mi">16</span><span class="p">:]</span>

<span class="n">prev_pt</span> <span class="o">=</span> <span class="n">iv</span>
    <span class="n">prev_ct</span> <span class="o">=</span> <span class="n">iv</span>

<span class="n">pt</span> <span class="o">=</span> <span class="o">&amp;</span><span class="c1">#39;&amp;#39;</span>
    <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">split_by</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="mi">16</span><span class="p">):</span>

        <span class="n">pt_block</span> <span class="o">=</span> <span class="n">xor</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="n">prev_ct</span><span class="p">)</span>

        <span class="n">pt_block</span> <span class="o">=</span> <span class="n">aes</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">pt_block</span><span class="p">)</span>

        <span class="n">pt_block</span> <span class="o">=</span> <span class="n">xor</span><span class="p">(</span><span class="n">pt_block</span><span class="p">,</span> <span class="n">prev_pt</span><span class="p">)</span>

        <span class="n">pt</span> <span class="o">+=</span> <span class="n">pt_block</span>

        <span class="n">prev_pt</span> <span class="o">=</span> <span class="n">pt_block</span>

        <span class="n">prev_ct</span> <span class="o">=</span> <span class="n">block</span>

<span class="n">pt</span><span class="p">,</span> <span class="n">mac</span> <span class="o">=</span> <span class="n">pt</span> <span class="p">[:</span> <span class="o">-</span> <span class="mi">16</span><span class="p">],</span> <span class="n">pt</span> <span class="p">[</span><span class="o">-</span><span class="mi">16</span><span class="p">:]</span>
    <span class="k">if</span> <span class="n">mac</span> <span class="o">!=</span> <span class="n">iv</span><span class="p">:</span>

        <span class="k">raise</span> <span class="n">CryptoError</span><span class="p">()</span>

<span class="k">return</span> <span class="n">unpad</span> <span class="p">(</span><span class="n">pt</span><span class="p">)</span>
</code></pre></div>

<p>Then at this point, the message decrypted by the server is</p>
<p>$ unpad (IV  oplus D (C_1  oplus IV)) $</p>
<h3 id="get-the-last-byte-of-the-plaintext">Get the last byte of the plaintext<a class="headerlink" href="#get-the-last-byte-of-the-plaintext" title="Permanent link">&para;</a></h3>
<p>We can consider controlling the D decrypted message as a constant value, such as all zeros, ie <code>C1=IV</code>, then we can enumerate the last byte of the IV from 0 to 255, get $IV \oplus D(C_1 \oplus IV) The last byte of $ is also 0~255. Only when it is 1~15, after the <code>unpad</code> operation, the message length is not 0. Therefore, we can count which numbers cause the length to be non-zero and enumerate as 1 and the remaining flags to 0.</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">getlast_byte</span><span class="p">(</span><span class="n">iv</span><span class="p">,</span> <span class="n">block</span><span class="p">):</span>

<span class="n">iv_pre</span> <span class="o">=</span> <span class="n">iv</span> <span class="p">[:</span> <span class="mi">15</span><span class="p">]</span>
<span class="n">iv_last</span> <span class="o">=</span> <span class="n">words</span> <span class="p">(</span><span class="n">iv</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;get last byte&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>

        <span class="n">send_data</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="n">iv</span> <span class="o">=</span> <span class="n">iv_pre</span> <span class="o">+</span> <span class="nb">chr</span> <span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">tmpblock</span> <span class="o">=</span> <span class="n">block</span><span class="p">[:</span><span class="mi">15</span><span class="p">]</span> <span class="o">+</span> <span class="nb">chr</span><span class="p">(</span><span class="n">i</span> <span class="o">^</span> <span class="nb">ord</span><span class="p">(</span><span class="n">block</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">^</span> <span class="n">iv_last</span><span class="p">)</span>

        <span class="n">payload</span> <span class="o">=</span> <span class="n">iv</span> <span class="o">+</span> <span class="n">tmpblock</span> <span class="o">+</span> <span class="n">iv</span>

        <span class="n">send_data</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>

        <span class="n">length</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">recv_data</span><span class="p">()</span>

        <span class="k">if</span> <span class="s1">&#39;Looks&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>

            <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">last_bytes</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">tmp</span> <span class="o">==</span> <span class="n">xor_byte_map</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>

            <span class="n">last_bytes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xor_byte_map</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;possible last byte is &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">last_bytes</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">last_bytes</span>
</code></pre></div>

<p>In addition, we can get all the possible cases of the last byte at the beginning of the table, recorded in xor_byte_map.</p>
<div class="codehilite"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">every item is a pair [a,b]</span>

<span class="sd">a is the xor list</span>

<span class="sd">b is the idx which is zero when xored</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="n">xor_byte_map</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>

    <span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>

        <span class="n">tmp</span> <span class="o">=</span> <span class="n">i</span> <span class="o">^</span> <span class="n">j</span>

        <span class="k">if</span> <span class="n">tmp</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">tmp</span> <span class="o">&lt;=</span> <span class="mi">15</span><span class="p">:</span>

            <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tmp</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

            <span class="n">b</span> <span class="o">=</span> <span class="n">j</span>

    <span class="n">xor_byte_map</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">])</span>
</code></pre></div>

<p>By comparing this table, we can know what is possible with the last byte.</p>
<h3 id="decrypt-any-encrypted-block">Decrypt any encrypted block<a class="headerlink" href="#decrypt-any-encrypted-block" title="Permanent link">&para;</a></h3>
<p>After obtaining the last byte of the plaintext, we can use the unpad vulnerability to get the corresponding plaintext content from length 1 to length 15.</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">dec_block</span><span class="p">(</span><span class="n">iv</span><span class="p">,</span> <span class="n">block</span><span class="p">):</span>

    <span class="n">last_bytes</span> <span class="o">=</span> <span class="n">getlast_byte</span><span class="p">(</span><span class="n">iv</span><span class="p">,</span> <span class="n">block</span><span class="p">)</span>



<span class="n">iv_pre</span> <span class="o">=</span> <span class="n">iv</span> <span class="p">[:</span> <span class="mi">15</span><span class="p">]</span>
<span class="n">iv_last</span> <span class="o">=</span> <span class="n">words</span> <span class="p">(</span><span class="n">iv</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;try to get plain&#39;</span><span class="p">)</span>

<span class="n">plain0</span> <span class="o">=</span> <span class="o">&amp;</span><span class="c1">#39;&amp;#39;</span>
    <span class="k">for</span> <span class="n">last_byte</span> <span class="ow">in</span> <span class="n">last_bytes</span><span class="p">:</span>

<span class="n">plain0</span> <span class="o">=</span> <span class="o">&amp;</span><span class="c1">#39;&amp;#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">15</span><span class="p">):</span>

            <span class="nb">print</span> <span class="s1">&#39;idx:&#39;</span><span class="p">,</span> <span class="n">i</span>

<span class="n">tag</span> <span class="o">=</span> <span class="n">false</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>

                <span class="n">send_data</span><span class="p">(</span><span class="n">plain0</span> <span class="o">+</span> <span class="nb">chr</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>

                <span class="n">pad_size</span> <span class="o">=</span> <span class="mi">15</span> <span class="o">-</span> <span class="n">i</span>

                <span class="n">iv</span> <span class="o">=</span> <span class="n">iv_pre</span> <span class="o">+</span> <span class="nb">chr</span><span class="p">(</span><span class="n">pad_size</span> <span class="o">^</span> <span class="n">last_byte</span><span class="p">)</span>

                <span class="n">tmpblock</span> <span class="o">=</span> <span class="n">block</span><span class="p">[:</span><span class="mi">15</span><span class="p">]</span> <span class="o">+</span> <span class="nb">chr</span><span class="p">(</span>

                    <span class="n">pad_size</span> <span class="o">^</span> <span class="n">last_byte</span> <span class="o">^</span> <span class="nb">ord</span><span class="p">(</span><span class="n">block</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">^</span> <span class="n">iv_last</span>

                <span class="p">)</span>

                <span class="n">payload</span> <span class="o">=</span> <span class="n">iv</span> <span class="o">+</span> <span class="n">tmpblock</span> <span class="o">+</span> <span class="n">iv</span>

                <span class="n">send_data</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>

                <span class="n">length</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">recv_data</span><span class="p">()</span>

                <span class="k">if</span> <span class="s1">&#39;Looks&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>

                    <span class="c1"># success</span>

<span class="n">plain0</span> <span class="o">+</span> <span class="o">=</span> <span class="nb">chr</span> <span class="p">(</span><span class="n">j</span><span class="p">)</span>
                    <span class="n">tag</span> <span class="o">=</span> <span class="kc">True</span>

                    <span class="k">break</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">tag</span><span class="p">:</span>

                <span class="k">break</span>

        <span class="c1"># means the last byte is ok</span>

        <span class="k">if</span> <span class="n">plain0</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>

            <span class="k">break</span>

    <span class="n">plain0</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">iv_last</span> <span class="o">^</span> <span class="n">last_byte</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">plain0</span>
</code></pre></div>

<h3 id="decrypt-the-specified-plaintext">Decrypt the specified plaintext<a class="headerlink" href="#decrypt-the-specified-plaintext" title="Permanent link">&para;</a></h3>
<p>This is relatively simple, we hope to use this to get the ciphertext of <code>gimme_flag</code></p>
<div class="codehilite"><pre><span></span><code>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;get the cipher of flag&#39;</span><span class="p">)</span>

    <span class="n">gemmi_iv1</span> <span class="o">=</span> <span class="n">xor</span><span class="p">(</span><span class="n">pad</span><span class="p">(</span><span class="s1">&#39;gimme_flag&#39;</span><span class="p">),</span> <span class="n">plain0</span><span class="p">)</span>

    <span class="n">gemmi_c1</span> <span class="o">=</span> <span class="n">xor</span><span class="p">(</span><span class="n">gemmi_iv1</span><span class="p">,</span> <span class="n">cipher0</span><span class="p">)</span>

    <span class="n">payload</span> <span class="o">=</span> <span class="n">gemmi_iv1</span> <span class="o">+</span> <span class="n">gemmi_c1</span> <span class="o">+</span> <span class="n">gemmi_iv1</span>

    <span class="n">send_data</span><span class="p">(</span><span class="s1">&#39;gimme_flag&#39;</span><span class="p">)</span>

    <span class="n">send_data</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>

    <span class="n">flag_len</span><span class="p">,</span> <span class="n">flag_cipher</span> <span class="o">=</span> <span class="n">recv_data</span><span class="p">()</span>
</code></pre></div>

<p>Where plain0 and cipher0 are the clear ciphertext pairs we obtained for AES encryption, excluding the two exclusive ORs before and after.</p>
<h3 id="decrypt-flag">Decrypt flag<a class="headerlink" href="#decrypt-flag" title="Permanent link">&para;</a></h3>
<p>This point is actually achieved by the function of decrypting any encrypted block, as follows</p>
<div class="codehilite"><pre><span></span><code>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;the flag cipher is &#39;</span> <span class="o">+</span> <span class="n">flag_cipher</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;hex&#39;</span><span class="p">))</span>

    <span class="n">flag_cipher</span> <span class="o">=</span> <span class="n">split_by</span><span class="p">(</span><span class="n">flag_cipher</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>



    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;decrypt the blocks one by one&#39;</span><span class="p">)</span>

    <span class="n">plain</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">flag_cipher</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;block: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

            <span class="n">plain</span> <span class="o">+=</span> <span class="n">dec_block</span><span class="p">(</span><span class="n">flag_cipher</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">flag_cipher</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>

        <span class="k">else</span><span class="p">:</span>

<span class="n">iv</span> <span class="o">=</span> <span class="n">plain</span> <span class="p">[</span><span class="o">-</span><span class="mi">16</span><span class="p">:]</span>
            <span class="n">cipher</span> <span class="o">=</span> <span class="n">xor</span><span class="p">(</span><span class="n">xor</span><span class="p">(</span><span class="n">iv</span><span class="p">,</span> <span class="n">flag_cipher</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">flag_cipher</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

            <span class="n">plain</span> <span class="o">+=</span> <span class="n">dec_block</span><span class="p">(</span><span class="n">iv</span><span class="p">,</span> <span class="n">cipher</span><span class="p">)</span>

            <span class="k">pass</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;now plain: &#39;</span> <span class="o">+</span> <span class="n">plain</span><span class="p">)</span>

    <span class="nb">print</span> <span class="n">plain</span>
</code></pre></div>

<p>Think about why the ciphertext operation after the second block will be different.</p>
<p>The complete code references the ctf-challenge repository.</p>
<h2 id="references">References<a class="headerlink" href="#references" title="Permanent link">&para;</a></h2>
<ul>
<li>[Packet Encryption Mode] (<a href="https://en.wikipedia.org/wiki/%E5%88%86%E7%BB%84%E5%AF%86%E7%A0%81%E5%B7%A5">https://en.wikipedia.org/wiki/%E5%88%86%E7%BB%84%E5%AF%86%E7%A0%81%E5%B7%A5</a>% E4%BD%9C%E6%A8%A1%E5%BC%8F)</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Padding_oracle_attack">https://en.wikipedia.org/wiki/Padding_oracle_attack</a></p>
</li>
<li>
<p><a href="http://netifera.com/research/poet/PaddingOraclesEverywhereEkoparty2010.pdf">http://netifera.com/research/poet/PaddingOraclesEverywhereEkoparty2010.pdf</a></p>
</li>
<li>
<p><a href="https://ctftime.org/writeup/7975">https://ctftime.org/writeup/7975</a></p>
</li>
<li>
<p><a href="https://ctftime.org/writeup/7974">https://ctftime.org/writeup/7974</a></p>
</li>
</ul>









  <h2 id="__comments">评论</h2>
  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = "https://ctf-wiki.github.io/ctf-wiki/crypto/blockcipher/mode/padding-oracle-attack/";
      this.page.identifier =
        "crypto/blockcipher/mode/padding-oracle-attack/";
    };
    (function() {
      var d = document, s = d.createElement("script");
      s.src = "//ctf-wiki.disqus.com/embed.js";
      s.setAttribute("data-timestamp", +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>


            </article>
          </div>
        </div>
      </main>


<footer class="md-footer">

  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">

          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2016 - 2020 CTF Wiki Team
          </div>

        powered by
        <a href="https://www.mkdocs.org" target="_blank" rel="noopener">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs</a>
      </div>

    </div>
  </div>
</footer>

    </div>

      <script src="../../../../assets/javascripts/application.c33a9706.js"></script>




          <script src="../../../../assets/javascripts/lunr/lunr.stemmer.support.js"></script>









      <script>app.initialize({version:"1.0.4",url:{base:"../../../.."}})</script>

        <script src="https://cdnjs.loli.net/ajax/libs/pangu/3.3.0/pangu.min.js"></script>

        <script src="../../../../_static/js/extra.js"></script>

        <script src="https://cdnjs.loli.net/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script>


  </body>
</html>
